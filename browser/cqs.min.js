(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var cqs=require("cqs");if(typeof window!=="undefined")window.cqs=cqs},{cqs:2}],2:[function(require,module,exports){module.require=require;require("defaultable")(module,{time_C:1,strictSSL:true},function(module,exports,DEFS,require){var lib=require("./lib.js"),util=require("util"),couch=require("./couch.js"),queue=require("./queue.js"),message=require("./message.js");module.exports={CreateQueue:queue.create,ListQueues:queue.list,SetQueueAttributes:queue.set,GetQueueAttributes:queue.get,SendMessage:queue.send,ReceiveMessage:queue.receive,ChangeMessageVisibility:message.change_visibility,DeleteMessage:message.del,Db:couch.Database,Queue:queue.Queue,Message:message.Message}})},{"./couch.js":3,"./lib.js":5,"./message.js":6,"./queue.js":25,defaultable:8,util:32}],3:[function(require,module,exports){var process=require("__browserify_process");module.require=require;var defaultable=require("defaultable");defaultable(module,{uuid_batch_size:100},function(module,exports,DEFS,require){var lib=require("./lib.js"),util=require("util"),events=require("events"),assert=require("assert"),follow=require("follow"),querystring=require("querystring");var KNOWN_COUCHES={};var UUIDS={};function Couch(opts){var self=this;self.url=typeof opts.url==="string"?opts.url:null;self.userCtx=opts.userCtx||null;self.time_C=opts.time_C||null;self.known_dbs=null;self.log=lib.log4js.getLogger("Couch/"+self.url);self.log.setLevel(lib.LOG_LEVEL)}Couch.prototype.request=function(opts,callback){var self=this;assert.ok(self.url);assert.ok(callback);if(typeof opts==="string")opts={uri:opts};opts.uri=self.url+"/"+opts.uri;opts.time_C=opts.time_C||self.time_C;self.confirmed(function(er){if(er)return callback(er);var method=opts.method||"GET";self.log.debug(method+" "+opts.uri);return lib.req_json(opts,callback)})};Couch.prototype.uuid=function get_uuid(count,callback){var self=this;if(typeof count==="function"){callback=count;count=1}var uuids=uuids_for(self);return uuids.get(count,callback)};Couch.prototype.confirmed=function confirm_couch(callback){var self=this;assert.ok(callback);assert.ok(self.url);if(self.userCtx&&self.known_dbs)return callback();self.url=self.url.replace(/\/+$/,"");var confirmer=KNOWN_COUCHES[self.url];if(!confirmer)confirmer=KNOWN_COUCHES[self.url]=new lib.Once;confirmer.on_done(function(er,userCtx,known_dbs){if(er)return callback(er);self.userCtx=userCtx;self.known_dbs=known_dbs;return callback()});function req(uri,cb){return lib.req_json({uri:uri,time_C:self.time_C},cb)}confirmer.job(function(done){self.log.debug("Confirming Couch: "+self.url);req(self.url,function(er,resp,body){if(er)return done(er);if(body.couchdb!=="Welcome")return done(new Error("Bad CouchDB response from "+self.url));self.log.debug("Confirming session");req(self.url+"/_session",function(er,resp,session){if(er)return done(er);if(!session.userCtx)return done(new Error("Bad CouchDB response: "+self.url+"/_session"));self.log.debug("Couch confirmed: "+self.url+": "+lib.JS(session.userCtx));var known_dbs={};return done(null,session.userCtx,known_dbs)})})})};function Database(opts){var self=this;opts=defaultable.merge(opts||{},DEFS);if(typeof opts.couch!=="string")throw new Error('Required "couch" option with URL of CouchDB');opts.db=opts.db||"";if(typeof opts.db!=="string")throw new Error('Optional "db" option must be string');self.name=opts.db;self.couch=new Couch({url:opts.couch,time_C:opts.time_C});self.secObj=null;self.known_queues=null;self.log=lib.log4js.getLogger("DB/"+self.name);self.log.setLevel(process.env.cqs_log_level||"info")}Database.prototype.request=function(opts,callback){var self=this;if(typeof opts==="string")opts={uri:opts};opts.uri=self.name+"/"+opts.uri;self.confirmed(function(er){if(er)return callback(er);self.couch.request(opts,callback)})};Database.prototype.changes=function(opts){var self=this;if(typeof opts!="object")opts={};opts.db=self.couch.url+"/"+self.name;return new follow.Feed(opts)};Database.prototype.confirmed=function(callback){var self=this;assert.ok(callback);assert.ok(self.couch);self.couch.confirmed(function(){var confirmer=self.couch.known_dbs[self.name];if(!confirmer)confirmer=self.couch.known_dbs[self.name]=new lib.Once;confirmer.on_done(function(er,secObj,known_queues){if(er)return callback(er);self.secObj=secObj;self.known_queues=known_queues;callback()});confirmer.job(confirm_db)});function confirm_db(done){self.log.debug("Confirming DB: "+self.name);self.couch.request(self.name,function(er,resp,db){if(er)return done(er);if(db.db_name!==self.name)return done(new Error('Expected DB name "'+self.name+'": '+db.db_name));self.log.debug("Checking _security: "+self.name);self.couch.request(self.name+"/_security",function(er,resp,secObj){if(er)return done(er);if(!secObj)return done(new Error("Bad _security response from "+self.name+": "+lib.JS(secObj)));self.log.debug("Confirmed DB: "+self.name+": "+lib.JS(secObj));var known_queues={};return done(null,secObj,known_queues)})})}};module.exports={Database:Database};function uuids_for(couch){UUIDS[couch.url]=UUIDS[couch.url]||new UUIDGetter(couch);return UUIDS[couch.url]}function UUIDGetter(couch){var self=this;self.couch=couch;self.waiting=[];self.pool=[];self.fetching=false}UUIDGetter.prototype.get=function(count,callback){var self=this;self.waiting.push({count:count,callback:callback});self.try_to_send()};UUIDGetter.prototype.try_to_send=function(){var self=this;if(self.fetching)return;var waiter=self.waiting[0];if(!waiter)return;if(waiter.count<=self.pool.length){self.respond(self.waiting.shift());return self.try_to_send()}self.fetch()};UUIDGetter.prototype.fetch=function(){var self=this;assert.equal(self.fetching,false,"Fetch called twice in a row: "+self.couch.url);self.fetching=true;self.couch.request("_uuids?count="+DEFS.uuid_batch_size,function(er,resp,result){self.fetching=false;if(er)self.waiting.forEach(function(waiter){waiter.callback(er)});else if(!result.uuids||result.uuids.length!==DEFS.uuid_batch_size){er=new Error("Unknown _uuids result: "+lib.JS(result));self.waiting.forEach(function(waiter){waiter.callback(er)})}else{self.pool=self.pool.concat(result.uuids);self.try_to_send()}})};UUIDGetter.prototype.respond=function(waiter){var self=this,count=waiter.count,callback=waiter.callback;var response=self.pool.slice(0,count);self.pool=self.pool.slice(count+1);if(response.length===1)response=response[0];callback(null,response)}})},{"./lib.js":5,__browserify_process:38,assert:26,defaultable:8,events:27,follow:9,querystring:30,util:32}],4:[function(require,module,exports){var Buffer=require("__browserify_Buffer").Buffer,__dirname="/node_modules/cqs";module.require=require;require("defaultable")(module,{},function(module,exports,DEFS,require){var fs=require("fs"),lib=require("./lib.js"),path=require("path"),util=require("util"),assert=require("assert");module.exports={DDoc:DDoc,validate_doc_update:validate_doc_update,visible_at:visible_at};var TEMPLATE={queues:{},views:{visible_at:{map:visible_at,reduce:"_count"}},validate_doc_update:validate_doc_update};function validate_doc_update(newDoc,oldDoc,userCtx,secObj){var ddoc=this;var msg_id_re=/^CQS\/(.+?)\/([0-9a-f]{32})($|\/(.*)$)/;if(!newDoc._id.match(/^CQS\//))throw{forbidden:"This database is for CQS only"};var match=newDoc._id.match(msg_id_re);if(!match)throw{forbidden:"Invalid message id"};var queue_id=match[1],msg_id=match[2];if(!(queue_id in ddoc.queues))throw{forbidden:"Queue does not exist: "+queue_id};var IS_DB_ADMIN=false;secObj.admins=secObj.admins||{};secObj.admins.names=secObj.admins.names||[];secObj.admins.roles=secObj.admins.roles||[];if(userCtx.roles.indexOf("_admin")!==-1)IS_DB_ADMIN=true;if(secObj.admins.names.indexOf(userCtx.name)!==-1)IS_DB_ADMIN=true;for(i=0;i<userCtx.roles;i++)if(secObj.admins.roles.indexOf(userCtx.roles[i])!==-1)IS_DB_ADMIN=true;var good_keys=["_id","_rev","_revisions","_deleted","SenderId","SentTimestamp","visible_at","ApproximateReceiveCount","ApproximateFirstReceiveTimestamp","MD5OfMessageBody","Body","ReceiverId"];var key;for(key in newDoc)if(good_keys.indexOf(key)===-1)throw{forbidden:"Invalid field: "+key};if(!newDoc._deleted){if(newDoc.Body===null||newDoc.Body===undefined)throw{forbidden:"Invalid .Body: "+JSON.stringify(newDoc.Body)}}else{if(!oldDoc||oldDoc.ReceiverId!==userCtx.name){if(IS_DB_ADMIN)log('Allowing db admin "'+userCtx.name+'" to delete: '+newDoc._id);else throw{forbidden:"You may not delete this document"}}return}if(!newDoc.visible_at)throw{forbidden:"Must set visible_at"};if(oldDoc){if(newDoc.ReceiverId!==userCtx.name&&!IS_DB_ADMIN)throw{forbidden:"Must set ReceiverId to your name: "+JSON.stringify(userCtx.name)}}else{if(newDoc.SenderId!==userCtx.name&&!IS_DB_ADMIN)throw{forbidden:"Must set SenderId to your name: "+JSON.stringify(userCtx.name)}}}function visible_at(doc){var msg_id_re=/^CQS\/(.+?)\/([0-9a-f]{32})($|\/(.*)$)/;var match=doc._id.match(msg_id_re);if(!match||!doc.visible_at)return;var queue_id=match[1],msg_id=match[2];var val={_id:doc._id,_rev:doc._rev};for(var a in doc)if(a.match(/^[A-Z]/))val[a]=doc[a];var key=[queue_id,doc.visible_at];emit(key,val)}function DDoc(){var self=this;self.copy_template();self._id="_design/cqs"}DDoc.prototype.log=lib.log4js.getLogger("ddoc");DDoc.prototype.log.setLevel(lib.LOG_LEVEL);DDoc.prototype.copy_template=function(){var self=this;var ddoc=templated_ddoc();lib.copy(ddoc,self)};DDoc.prototype.add_browser=function(callback){var self=this;if(require.isBrowser){return callback()}var home=__dirname,include_dirs=[home,home+"/test",home+"/test/browser/node",home+"/test/browser"];self._attachments=self._attachments||{};var requirejs_paths={request:"../request.jquery"};function finish(){var opts={baseUrl:"cqs",paths:requirejs_paths};var boot_js=["require(","// Options",lib.JS(opts)+",","","// Modules",'["main.js"],',"","// Code to run when ready","function(main) { return main(); }",");"].join("\n");self._attachments["boot.js"]={content_type:"application/javascript",data:new Buffer(boot_js).toString("base64")};return callback()}get_dir();function get_dir(){var dir_path=include_dirs.shift();if(!dir_path)return finish();self.log.debug("Fetching files from: "+dir_path);fs.readdir(dir_path,function(er,files){if(er)return callback(er);self.log.debug("Files: "+lib.JS(files));files=files.filter(function(file){return/\.js$/.test(file)||/\.html$/.test(file)});get_file();function get_file(){var filename=files.shift();if(!filename)return get_dir();self.log.debug("Loading file: "+filename);fs.readFile(dir_path+"/"+filename,null,function(er,content){if(er&&er.errno)er=new Error(er.stack);if(er)return callback(er);var match,require_re=/\brequire\(['"]([\w\d\-_\/\.]+?)['"]\)/g,dependencies={};if(dir_path===home+"/test"&&filename==="run.js"){content=content.toString("utf8").split(/\n/).map(function(line){return line.replace(/^(#!.*)$/,"// $1")}).join("\n");content=new Buffer(content)}if(dir_path===home||dir_path===home+"/test"){content=content.toString("utf8");while(match=require_re.exec(content))dependencies[match[1]]=true;dependencies=Object.keys(dependencies);content=["require.def(function(require, exports, module) {","",content,"; return(module.exports);","}); // define"].join("");content=new Buffer(content)}var att_dir=dir_path.replace(new RegExp("^"+home+"/?"),"");if(att_dir==""||att_dir=="test/browser/node")att_dir="cqs/";else if(att_dir=="test")att_dir="cqs/test/";else if(att_dir=="test/browser")att_dir="";else return callback(new Error("Unknown directory: "+att_dir));var att=att_dir+filename;var type=/\.html$/.test(filename)?"text/html; charset=utf-8":"application/javascript";self._attachments[att]={content_type:type,data:content.toString("base64")};get_file()})}})}};function templated_ddoc(name){return stringify_functions(TEMPLATE);function stringify_functions(obj){var copy={};if(Array.isArray(obj))return obj.map(stringify_functions);else if(typeof obj==="object"&&obj!==null){Object.keys(obj).forEach(function(key){copy[key]=stringify_functions(obj[key])});return copy}else if(typeof obj==="function")return func_from_template(obj);else return lib.JDUP(obj)}}function func_from_template(func){var src=func.toString();src=src.replace(/^function.*?\(/,"function (");return src}})},{"./lib.js":5,__browserify_Buffer:37,assert:26,defaultable:8,fs:28,path:29,util:32}],5:[function(require,module,exports){var process=require("__browserify_process");module.require=require;require("defaultable")(module,{request_timeout:5e3,log_module:null,strictSSL:true},function(module,exports,DEFS,require){var request=require("request").defaults({strictSSL:DEFS.strictSSL}),events=require("events");exports.log4js=DEFS.log_module||require("log4js");exports.LOG_LEVEL=process.env.cqs_log_level||"info";exports.instanceof=function instance0f(obj,type){if(typeof type!="function"||typeof obj!="object")return false;return!!(obj&&obj.constructor&&obj.constructor.name===type.name)};exports.scrub_creds=function scrub_creds(url){return url.replace(/^(https?:\/\/)[^:]+:[^@]+@(.*)$/,"$1$2")};exports.JP=JSON.parse;exports.JS=JSON.stringify;exports.JDUP=function(obj){return JSON.parse(JSON.stringify(obj))};exports.copy=function(src,dst,pred){pred=pred||function(){return true};if(pred==="uppercase")pred=function(key){return/^[A-Z]/.test(key)};Object.keys(src).forEach(function(key){var val=src[key];if(pred(key,val))dst[key]=val})};exports.opt_def=function(opts){if(typeof opts==="string")opts={_str:opts};else if(typeof opts==="function")opts={_func:opts};return opts};exports.req_json=function req_json(opts,callback){if(typeof opts==="string")opts={uri:opts};var couch_errors_are_ok=!!opts.couch_errors;opts.headers=opts.headers||{};opts.headers["accept"]="application/json";opts.headers["content-type"]="application/json";if(!("followRedirect"in opts))opts.followRedirect=false;opts.json=opts.json||true;var started_at=new Date;var timer_ms=(opts.timeout||DEFS.request_timeout)*(opts.time_C||1);delete opts.time_C;var in_flight=request(opts,on_req_done);var timed_out=false,timer=setTimeout(on_timeout,timer_ms);function on_timeout(){timed_out=true;var duration=new Date-started_at;var timeout_er=new Error("Request timeout ("+(duration/1e3).toFixed(1)+"s): "+opts.uri);timeout_er.timeout=duration;if(in_flight&&in_flight.req&&in_flight.req.connection&&in_flight.req.connection.destroy)in_flight.req.connection.destroy();if(in_flight&&in_flight.destroy)in_flight.destroy();callback(timeout_er)}return in_flight;function on_req_done(er,resp,body){clearTimeout(timer);if(timed_out)return;if(er)return callback(er);if(resp.statusCode<200||resp.statusCode>=300)if(!couch_errors_are_ok){er=new Error("Couch response "+resp.statusCode+" to "+opts.uri+": "+exports.JS(body));er.statusCode=resp.statusCode;for(var key in body)er[key]=body[key];return callback(er)}return callback(null,resp,body)}};exports.enc_id=function encode_doc_id(id){return encodeURIComponent(id).replace(/^_design%2[fF]/,"_design/")};exports.Once=Once;function Once(){var self=this;self.task=null;self.is_done=false;self.pending=null;self.result=undefined;self.listener_count=0}Once.prototype.on_done=function(callback){var self=this;if(self.is_done)return callback.apply(null,self.result);self.pending=self.pending||new events.EventEmitter;self.listener_count+=1;self.pending.setMaxListeners(10+self.listener_count);self.pending.on("done",callback)};Once.prototype.job=function(task){var self=this;if(self.task)return;self.task=task;self.pending=self.pending||new events.EventEmitter;task(on_done);function on_done(){self.is_done=true;self.result=Array.prototype.slice.call(arguments);self.pending.emit.apply(self.pending,["done"].concat(self.result))}}})},{__browserify_process:38,defaultable:8,events:27,log4js:18,request:7}],6:[function(require,module,exports){module.require=require;require("defaultable")(module,{},function(module,exports,DEFS,require){var lib=require("./lib.js"),util=require("util"),couch=require("./couch.js"),events=require("events"),assert=require("assert"),querystring=require("querystring");function Message(opts){var self=this;events.EventEmitter.call(self);lib.copy(opts,self,"uppercase");self.MessageId=opts.MessageId||opts._id||null;self.Body=opts.MessageBody||opts.Body||opts._str||null;self.MD5OfMessageBody=null;self.IdExtra=opts.IdExtra||null;self.queue=opts.queue||null;self.is_heartbeat=opts.is_heartbeat||false;self.log=lib.log4js.getLogger("Message/"+(self.MessageId||"untitled"));self.log.setLevel(lib.LOG_LEVEL)}util.inherits(Message,events.EventEmitter);Message.prototype.assert_received=function assert_received(){var self=this;assert.ok(self.queue,"Message not usable (no queue)");assert.ok(self.queue.db,"Message not usable (no queue db)");assert.ok(self.ReceiptHandle,"Message not usable (no ReceiptHandle)")};Message.prototype.make_doc=function(){var self=this;var doc=lib.JDUP(self.mvcc||{});lib.copy(self,doc,"uppercase");delete doc.MessageId;delete doc.IdExtra;delete doc.VisibilityTimeout;delete doc.ReceiptHandle;return doc};Message.prototype.send=function send_message(cb){var self=this;assert.ok(cb);assert.ok(self.queue);assert.ok(self.queue.db);assert.ok(self.queue.db.couch);var db=self.queue.db;db.couch.uuid(function(er,uuid){if(er)return cb(er);var message_id=self.MessageId||uuid;if(typeof self.IdExtra==="string")message_id+="/"+self.IdExtra;var doc_id="CQS/"+self.queue.name+"/"+message_id,sender_id=db.couch.userCtx.name,now=new Date;var doc={_id:doc_id,SenderId:sender_id,SentTimestamp:now,visible_at:now,ApproximateReceiveCount:0,ApproximateFirstReceiveTimestamp:null,Body:self.Body};db.request({method:"PUT",uri:lib.enc_id(doc._id),json:doc},function(er,resp,result){if(er)return cb(er);self.MessageId=message_id;cb(null,self)})})};Message.prototype.update=function update_message(callback){var self=this;assert.ok(callback);assert.ok(callback);assert.ok(self.queue);assert.ok(self.queue.db);var doc_id=lib.enc_id("CQS/"+self.queue.name+"/"+self.MessageId);self.queue.db.request({uri:doc_id,couch_errors:true},function(er,resp,doc){if(er)return callback(er);var key;if(resp.statusCode===200)lib.copy(doc,self,"uppercase");else{for(key in self)if(/^[A-Z]/.test(key))delete self[key];self.deleted=true}return callback(null,self)})};Message.prototype.receive=function receive_message(callback){var self=this;assert.ok(callback);assert.ok(self.queue);assert.ok(self.queue.db);assert.ok(self.queue.db.couch);assert.ok(self.mvcc);assert.ok(self.mvcc._id);assert.ok(new RegExp("/"+self.MessageId+"$").test(self.mvcc._id),lib.JS({_id:self.mvcc._id,ID:self.MessageId}));assert.ok("ApproximateReceiveCount"in self,util.inspect(self));assert.ok("ApproximateFirstReceiveTimestamp"in self);self.queue.confirmed(function(er){if(er)return callback(er);var doc=self.make_doc();doc.ReceiverId=self.queue.db.couch.userCtx.name;doc.ApproximateReceiveCount+=1;if(doc.ApproximateFirstReceiveTimestamp===null)doc.ApproximateFirstReceiveTimestamp=new Date;var timeout=self.VisibilityTimeout||self.queue.VisibilityTimeout;var visible_at=new Date;visible_at.setUTCMilliseconds(visible_at.getUTCMilliseconds()+timeout*1e3);doc.visible_at=visible_at;var path=lib.enc_id(doc._id);self.queue.db.request({method:"PUT",uri:path,json:doc},function(er,resp,result){if(er)return callback(er);if(result.ok!==true)return callback(new Error("Bad doc update result: "+lib.JS(result)));doc._rev=result.rev;self.reset(doc,visible_at);callback(null,self)})})};Message.prototype.reset=function(doc,new_visible_at){var self=this;if(doc&&new_visible_at){delete self.mvcc;self.import_doc(doc);self.visible_at=new_visible_at;self.ReceiptHandle={_id:doc._id,_rev:doc._rev}}self.receive_timers=self.receive_timers||[];self.receive_timers.forEach(function(timer){clearTimeout(timer)});self.receive_timers=[];var reset_at=new Date,receipt_ms=new_visible_at-reset_at,warning_interval_ms,a,warner;if(new_visible_at&&self.is_heartbeat){for(a=1;a<=12;a++){warning_interval_ms=receipt_ms*(a/12);warner=setTimeout(on_warn,warning_interval_ms);self.receive_timers.push(warner)}}function on_warn(){var interval_at=new Date,elapsed_ms=interval_at-reset_at,elapsed_pc=100*elapsed_ms/receipt_ms;self.emit("heartbeat",elapsed_pc)}};Message.prototype.visibility=Message.prototype.change_visibility=function(new_time,callback){var self=this;assert.ok(callback);try{self.assert_received()}catch(er){return callback(er)}var delta_ms,now=new Date;if(typeof new_time==="number"){delta_ms=new_time*1e3;new_time=new Date;new_time.setUTCMilliseconds(new_time.getUTCMilliseconds()+delta_ms)}else{delta_ms=new_time-now;if(delta_ms<0)return callback(new Error("Requested change "+lib.JS(new_time)+" is too late"));if(delta_ms<2e3)return callback(new Error("Requested change "+lib.JS(new_time)+" is less than 2s from now"))}self.mvcc={_id:self.ReceiptHandle._id,_rev:self.ReceiptHandle._rev};var doc=self.make_doc();doc.visible_at=new_time;var path=lib.enc_id(doc._id);self.queue.db.request({method:"PUT",uri:path,json:doc},function(er,resp,result){if(er)return callback(er);if(result.ok!==true)return callback(new Error("Bad doc update result: "+lib.JS(result)));doc._rev=result.rev;self.reset(doc,new_time);callback(null,self)})};Message.prototype.del=function message_del(callback){var self=this;assert.ok(callback);try{self.assert_received()}catch(er){return callback(er)}var id=self.ReceiptHandle._id;var req={method:"DELETE",uri:lib.enc_id(id)+"?rev="+self.ReceiptHandle._rev,headers:{"content-type":"application/json"}};self.queue.db.request(req,function(er,resp,result){if(er)self.log.info("Failed to delete "+id+": "+er.message);if(!result||result.ok!==true)self.log.info("Unknown response to delete"+lib.JS(result));Object.keys(self).forEach(function(key){if(/^[A-Z]/.test(key))delete self[key]});self.reset();return callback(null,self)})};Message.prototype.import_doc=function(doc){var self=this;lib.copy(doc,self,"uppercase")};function change_visibility(opts,VisibilityTimeout,callback){var message;if(lib.instanceof(opts,Message))message=opts;else if(opts.ReceiptHandle)return callback(new Error('ReceiptHandle is unsupported, use "Message" instead with message object'));else if(opts.Message||opts.message)message=opts.Message||opts.message;else return callback(new Error("Unknown options: "+lib.JS(opts)));return message.change_visibility(VisibilityTimeout,callback)}function delete_message(msg,cb){return msg.del(cb)}module.exports={Message:Message,change_visibility:change_visibility,del:delete_message}})},{"./couch.js":3,"./lib.js":5,assert:26,defaultable:8,events:27,querystring:30,util:32}],7:[function(require,module,exports){var XHR=XMLHttpRequest;if(!XHR)throw new Error("missing XMLHttpRequest");module.exports=request;request.log={trace:noop,debug:noop,info:noop,warn:noop,error:noop};var DEFAULT_TIMEOUT=3*60*1e3;function request(options,callback){if(typeof callback!=="function")throw new Error("Bad callback given: "+callback);if(!options)throw new Error("No options given");var options_onResponse=options.onResponse;if(typeof options==="string")options={uri:options};else options=JSON.parse(JSON.stringify(options));options.onResponse=options_onResponse;if(options.verbose)request.log=getLogger();if(options.url){options.uri=options.url;delete options.url}if(!options.uri&&options.uri!=="")throw new Error("options.uri is a required argument");if(typeof options.uri!="string")throw new Error("options.uri must be a string");var unsupported_options=["proxy","_redirectsFollowed","maxRedirects","followRedirect"];for(var i=0;i<unsupported_options.length;i++)if(options[unsupported_options[i]])throw new Error("options."+unsupported_options[i]+" is not supported");options.callback=callback;options.method=options.method||"GET";options.headers=options.headers||{};options.body=options.body||null;options.timeout=options.timeout||request.DEFAULT_TIMEOUT;if(options.headers.host)throw new Error("Options.headers.host is not supported");if(options.json){options.headers.accept=options.headers.accept||"application/json";if(options.method!=="GET")options.headers["content-type"]="application/json";if(typeof options.json!=="boolean")options.body=JSON.stringify(options.json);else if(typeof options.body!=="string")options.body=JSON.stringify(options.body)}options.onResponse=options.onResponse||noop;if(options.onResponse===true){options.onResponse=callback;options.callback=noop}if(!options.headers.authorization&&options.auth)options.headers.authorization="Basic "+b64_enc(options.auth.username+":"+options.auth.password);return run_xhr(options)}var req_seq=0;function run_xhr(options){var xhr=new XHR,timed_out=false,is_cors=is_crossDomain(options.uri),supports_cors="withCredentials"in xhr;req_seq+=1;xhr.seq_id=req_seq;xhr.id=req_seq+": "+options.method+" "+options.uri;xhr._id=xhr.id;if(is_cors&&!supports_cors){var cors_err=new Error("Browser does not support cross-origin request: "+options.uri);cors_err.cors="unsupported";return options.callback(cors_err,xhr)}xhr.timeoutTimer=setTimeout(too_late,options.timeout);function too_late(){timed_out=true;var er=new Error("ETIMEDOUT");er.code="ETIMEDOUT";er.duration=options.timeout;request.log.error("Timeout",{id:xhr._id,milliseconds:options.timeout});return options.callback(er,xhr)}var did={response:false,loading:false,end:false};xhr.onreadystatechange=on_state_change;xhr.open(options.method,options.uri,true);if(is_cors)xhr.withCredentials=!!options.withCredentials;xhr.send(options.body);return xhr;function on_state_change(event){if(timed_out)return request.log.debug("Ignoring timed out state change",{state:xhr.readyState,id:xhr.id});request.log.debug("State change",{state:xhr.readyState,id:xhr.id,timed_out:timed_out});if(xhr.readyState===XHR.OPENED){request.log.debug("Request started",{id:xhr.id});for(var key in options.headers)xhr.setRequestHeader(key,options.headers[key])}else if(xhr.readyState===XHR.HEADERS_RECEIVED)on_response();else if(xhr.readyState===XHR.LOADING){on_response();on_loading()}else if(xhr.readyState===XHR.DONE){on_response();on_loading();on_end()}}function on_response(){if(did.response)return;did.response=true;request.log.debug("Got response",{id:xhr.id,status:xhr.status});clearTimeout(xhr.timeoutTimer);xhr.statusCode=xhr.status;if(is_cors&&xhr.statusCode==0){var cors_err=new Error("CORS request rejected: "+options.uri);cors_err.cors="rejected";did.loading=true;did.end=true;return options.callback(cors_err,xhr)}options.onResponse(null,xhr)}function on_loading(){if(did.loading)return;did.loading=true;request.log.debug("Response body loading",{id:xhr.id})}function on_end(){if(did.end)return;did.end=true;request.log.debug("Request done",{id:xhr.id});xhr.body=xhr.responseText;if(options.json){try{xhr.body=JSON.parse(xhr.responseText)}catch(er){return options.callback(er,xhr)}}options.callback(null,xhr,xhr.body)}}request.withCredentials=false;request.DEFAULT_TIMEOUT=DEFAULT_TIMEOUT;request.defaults=function(options,requester){var def=function(method){var d=function(params,callback){if(typeof params==="string")params={uri:params};else{params=JSON.parse(JSON.stringify(params))}for(var i in options){if(params[i]===undefined)params[i]=options[i]}return method(params,callback)};return d};var de=def(request);de.get=def(request.get);de.post=def(request.post);de.put=def(request.put);de.head=def(request.head);return de};var shortcuts=["get","put","post","head"];shortcuts.forEach(function(shortcut){var method=shortcut.toUpperCase();var func=shortcut.toLowerCase();request[func]=function(opts){if(typeof opts==="string")opts={method:method,uri:opts};else{opts=JSON.parse(JSON.stringify(opts));opts.method=method}var args=[opts].concat(Array.prototype.slice.apply(arguments,[1]));return request.apply(this,args)}});request.couch=function(options,callback){if(typeof options==="string")options={uri:options};options.json=true;if(options.body)options.json=options.body;delete options.body;callback=callback||noop;var xhr=request(options,couch_handler);return xhr;function couch_handler(er,resp,body){if(er)return callback(er,resp,body);if((resp.statusCode<200||resp.statusCode>299)&&body.error){er=new Error("CouchDB error: "+(body.error.reason||body.error.error));for(var key in body)er[key]=body[key];return callback(er,resp,body)}return callback(er,resp,body)}};function noop(){}function getLogger(){var logger={},levels=["trace","debug","info","warn","error"],level,i;for(i=0;i<levels.length;i++){level=levels[i];logger[level]=noop;if(typeof console!=="undefined"&&console&&console[level])logger[level]=formatted(console,level)}return logger}function formatted(obj,method){return formatted_logger;function formatted_logger(str,context){if(typeof context==="object")str+=" "+JSON.stringify(context);return obj[method].call(obj,str)}}function is_crossDomain(url){var rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;var ajaxLocation;try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}var ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],parts=rurl.exec(url.toLowerCase());var result=!!(parts&&(parts[1]!=ajaxLocParts[1]||parts[2]!=ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))));return result}function b64_enc(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data}do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join("");switch(data.length%3){case 1:enc=enc.slice(0,-2)+"==";break;case 2:enc=enc.slice(0,-1)+"=";break}return enc}},{}],8:[function(require,module,exports){module.exports=good_args(defaultable);module.exports.def=good_args(fresh_defaultable);module.exports.merge=merge_obj;var path_lib=require("path");var real_require=require;function fresh_defaultable(_mod,_defs,_definer){var mod=defaultable.apply(this,arguments);mod.defaults._defaultable.fresh=true;return mod}function defaultable(real_module,initial_defs,definer){if(!real_module||!real_module.exports)throw new Error("Need to provide the module, with .exports object");if(!is_obj(initial_defs))throw new Error("Defaults must be an object");var mod_dir=path_lib.dirname(real_module.filename||real_module.id);var mod_require=real_module.require||workaround_require;workaround_require._defaultable=true;function workaround_require(path){if(/^\.\//.test(path)||/^\.\.\//.test(path))path=path_lib.resolve(mod_dir,path);try{return real_require(path)}catch(er){if(er[0]!=="error"||er[1]!=="invalid_require_path"||er[2]!=="Must require a JavaScript string, not: object")throw er;try{return real_require(path+"/index")}catch(er2){throw er}}}var defaulter=make_defaulter({});real_module.exports=defaulter(initial_defs);return real_module.exports;function make_defaulter(old_defs){defaulter._defaultable={};return defaulter;function defaulter(new_defs){var faux_exports={};var faux_module={exports:faux_exports};var final_defs=merge_obj(new_defs||{},old_defs);require._defaultable=true;function require(path){var mod=mod_require.call(real_module,path);if(mod.defaults&&typeof mod.defaults==="function"&&mod.defaults._defaultable&&!mod.defaults._defaultable.fresh)return mod.defaults(final_defs);return mod}definer(faux_module,faux_exports,final_defs,require);var api=faux_module.exports;if("defaults"in api&&!api.defaults._defaultable)throw new Error('defaultable modules may not export a label called "defaults"');else api.defaults=make_defaulter(final_defs);
return api}}}function merge_obj(high,low){if(!is_obj(high))throw new Error("Bad merge high-priority");if(!is_obj(low))throw new Error("Bad merge low-priority");var keys=[];function add_key(k){if(!~keys.indexOf(k))keys.push(k)}_each(_keys(high),add_key);_each(_keys(low),add_key);var result={};_each(keys,function(key){var high_val=high[key];var low_val=low[key];if(is_obj(high_val)&&is_obj(low_val))result[key]=merge_obj(high_val,low_val);else if(key in high)result[key]=high[key];else if(key in low)result[key]=low[key];else throw new Error("Unknown key type: "+key)});return result}function _keys(obj){if(Object.keys)return Object.keys(obj);var keys=[];for(var k in obj){if(obj.hasOwnProperty(k))keys.push(k)}return keys}function _each(obj,fn){for(var i=0,len=obj.length;i<len;i++){fn(obj[i])}}function isArray(obj){if(Array.isArray)return Array.isArray(obj);return toString.call(obj)==="[object Array]"}function good_args(func){return good;function good(_Mod,_Defs,_Definer){var args=Array.prototype.slice.call(arguments);var m0dule={exports:{}};if(args.length==1)return func(m0dule,{},args[0]);else if(args.length==2)return func(m0dule,args[0],args[1]);else if(args.length>2)return func.apply(this,args);else throw new Error("Unknown arguments: "+JSON.stringify(args))}}function is_obj(val){return val&&!isArray(val)&&typeof val==="object"}},{path:29}],9:[function(require,module,exports){var process=require("__browserify_process");module.require=require;var feed=require("./lib/feed"),stream=require("./lib/stream");function follow_feed(opts,cb){var ch_feed=new feed.Feed(opts);ch_feed.on("error",function(er){return cb&&cb.call(ch_feed,er)});ch_feed.on("change",function(ch){return cb&&cb.call(ch_feed,null,ch)});process.nextTick(function(){ch_feed.follow()});return ch_feed}module.exports=follow_feed;module.exports.Feed=feed.Feed;module.exports.Changes=stream.Changes},{"./lib/feed":10,"./lib/stream":12,__browserify_process:38}],10:[function(require,module,exports){var process=require("__browserify_process");module.require=require;var lib=require("../lib"),util=require("util"),events=require("events"),request=require("request"),Changes=require("./stream").Changes,querystring=require("querystring");var setTimeout=lib.setTimeout,clearTimeout=lib.clearTimeout;var DEFAULT_HEARTBEAT=3e4;var HEARTBEAT_TIMEOUT_COEFFICIENT=1.25;var DEFAULT_MAX_RETRY_SECONDS=60*60;var INITIAL_RETRY_DELAY=1e3;var FEED_PARAMETERS=["since","limit","feed","heartbeat","filter","include_docs"];var EventEmitter=events.EventEmitter2||events.EventEmitter;util.inherits(Feed,EventEmitter);function Feed(opts){var self=this;EventEmitter.call(self);self.feed="continuous";self.heartbeat=DEFAULT_HEARTBEAT;self.max_retry_seconds=DEFAULT_MAX_RETRY_SECONDS;self.inactivity_ms=null;self.headers={};self.request={};self.since=0;self.is_paused=false;self.caught_up=false;self.retry_delay=INITIAL_RETRY_DELAY;self.query_params={};opts=opts||{};if(typeof opts==="string")opts={db:opts};opts.db=opts.db||opts.url||opts.uri;delete opts.url;delete opts.uri;Object.keys(opts).forEach(function(key){self[key]=opts[key]});self.pending={request:null,activity_at:null}}Feed.prototype.start=Feed.prototype.follow=function follow_feed(){var self=this;if(!self.db)throw new Error("Database URL required");if(self.feed!=="continuous"&&self.feed!=="longpoll")throw new Error('The only valid feed options are "continuous" and "longpoll"');if(typeof self.heartbeat!=="number")throw new Error('Required "heartbeat" value');self.log=lib.log4js.getLogger(self.db);self.log.setLevel(process.env.follow_log_level||"info");self.emit("start");return self.confirm()};Feed.prototype.confirm=function confirm_feed(){var self=this;self.db_safe=lib.scrub_creds(self.db);self.log.debug("Checking database: "+self.db_safe);var confirm_timeout=self.heartbeat*3;var timeout_id=setTimeout(function(){return self.die(new Error("Timeout confirming database: "+self.db_safe))},confirm_timeout);var headers=lib.JP(lib.JS(self.headers));headers.accept="application/json";var req=request({uri:self.db,headers:headers},db_response);self.emit("confirm_request",req);function db_response(er,resp,body){clearTimeout(timeout_id);if(er)return self.die(er);var db;try{db=JSON.parse(body)}catch(json_er){return self.emit("error",json_er)}if(!db.db_name||!db.instance_start_time)return self.emit("error",new Error("Bad DB response: "+body));self.original_db_seq=db.update_seq;self.log.debug("Confirmed db: "+self.db_safe);self.emit("confirm",db);if(self.since=="now"){self.log.debug('Query since "now" is the same as query since -1');self.since=-1}if(self.since<0){self.log.debug("Query since "+self.since+" will start at "+(db.update_seq+self.since+1));self.since=db.update_seq+self.since+1}if(self.original_db_seq==self.since){self.caught_up=true;self.emit("catchup",db.update_seq)}return self.query()}};Feed.prototype.query=function query_feed(){var self=this;var query_params=JSON.parse(JSON.stringify(self.query_params));FEED_PARAMETERS.forEach(function(key){if(key in self)query_params[key]=self[key]});if(typeof query_params.filter!=="string")delete query_params.filter;if(typeof self.filter==="function"&&!query_params.include_docs){self.log.debug("Enabling include_docs for client-side filter");query_params.include_docs=true}var poll_size=100;if(query_params.feed=="longpoll"&&(!query_params.limit||query_params.limit>poll_size))query_params.limit=poll_size;var feed_url=self.db+"/_changes?"+querystring.stringify(query_params);self.headers.accept=self.headers.accept||"application/json";var req={method:"GET",uri:feed_url,headers:self.headers,encoding:"utf-8",onResponse:on_feed_response};req.changes_query=query_params;Object.keys(self.request).forEach(function(key){req[key]=self.request[key]});var now=new Date,feed_ts=lib.JDUP(now),feed_id=process.env.follow_debug?feed_ts.match(/\.(\d\d\d)Z$/)[1]:feed_ts;self.log.debug("Feed query "+feed_id+": "+lib.scrub_creds(feed_url));var feed_request=request(req);feed_request.on("response",function(){self.log.debug("Remove feed from agent pool: "+feed_id);feed_request.req.socket.emit("agentRemove")});var response_timer=setTimeout(response_timed_out,self.heartbeat),timed_out=false;return self.emit("query",feed_request);function response_timed_out(){self.log.debug("Feed response timed out: "+feed_id);timed_out=true;return self.retry()}function on_feed_response(er,resp,body){clearTimeout(response_timer);if(resp!==undefined&&resp.body||body)return self.die(new Error("Cannot handle a body in the feed response: "+lib.JS(resp.body||body)));if(timed_out){self.log.debug("Ignoring late response: "+feed_id);return destroy_response(resp)}if(er){self.log.debug("Request error "+feed_id+": "+er.stack);destroy_response(resp);return self.retry()}if(resp.statusCode!==200){self.log.debug("Bad changes response "+feed_id+": "+resp.statusCode);destroy_response(resp);return self.retry()}self.log.debug("Good response: "+feed_id);self.retry_delay=INITIAL_RETRY_DELAY;self.emit("response",resp);var changes_stream=new Changes;changes_stream.log=lib.log4js.getLogger("stream "+self.db);changes_stream.log.setLevel(self.log.level.levelStr);changes_stream.feed=self.feed;feed_request.pipe(changes_stream);changes_stream.created_at=now;changes_stream.id=function(){return feed_id};return self.prep(changes_stream)}};Feed.prototype.prep=function prep_request(changes_stream){var self=this;var now=new Date;self.pending.request=changes_stream;self.pending.activity_at=now;self.pending.wait_timer=null;if(self.is_paused)self.pause();else self.resume();self.change_at=now;if(self.inactivity_ms){clearTimeout(self.inactivity_timer);self.inactivity_timer=setTimeout(function(){self.on_inactivity()},self.inactivity_ms)}changes_stream.on("heartbeat",handler_for("heartbeat"));changes_stream.on("error",handler_for("error"));changes_stream.on("data",handler_for("data"));changes_stream.on("end",handler_for("end"));return self.wait();function handler_for(ev){var name="on_couch_"+ev;var inner_handler=self[name];return handle_confirmed_req_event;function handle_confirmed_req_event(){if(self.pending.request===changes_stream)return inner_handler.apply(self,arguments);if(!changes_stream.created_at)return self.die(new Error("Received data from unknown request"));var s_to_now=(new Date-changes_stream.created_at)/1e3;var s_to_req="[no req]";if(self.pending.request)s_to_req=(self.pending.request.created_at-changes_stream.created_at)/1e3;var msg=": "+changes_stream.id()+" to_req="+s_to_req+"s, to_now="+s_to_now+"s";if(ev=="end"||ev=="data"||ev=="heartbeat"){self.log.debug('Old "'+ev+'": '+changes_stream.id());return destroy_req(changes_stream)}self.log.warn('Old "'+ev+'"'+msg)}}};Feed.prototype.wait=function wait_for_event(){var self=this;self.emit("wait");if(self.pending.wait_timer)return self.die(new Error("wait() called but there is already a wait_timer: "+self.pending.wait_timer));var timeout_ms=self.heartbeat*HEARTBEAT_TIMEOUT_COEFFICIENT;var req_id=self.pending.request&&self.pending.request.id();var msg="Req "+req_id+" timeout="+timeout_ms;if(self.inactivity_ms)msg+=", inactivity="+self.inactivity_ms;msg+=": "+self.db_safe;self.log.debug(msg);self.pending.wait_timer=setTimeout(function(){self.on_timeout()},timeout_ms)};Feed.prototype.got_activity=function(){var self=this;if(!self.pending.wait_timer)return self.die(new Error("Cannot find wait timer"));clearTimeout(self.pending.wait_timer);self.pending.wait_timer=null;self.pending.activity_at=new Date};Feed.prototype.pause=function(){var self=this,was_paused=self.is_paused;self.is_paused=true;if(self.pending&&self.pending.request&&self.pending.request.pause)self.pending.request.pause();else self.log.warn("No pending request to pause");if(!was_paused)self.emit("pause")};Feed.prototype.resume=function(){var self=this,was_paused=self.is_paused;self.is_paused=false;if(was_paused)self.emit("resume");if(self.pending&&self.pending.request&&self.pending.request.resume)self.pending.request.resume();else self.log.warn("No pending request to resume")};Feed.prototype.on_couch_heartbeat=function on_couch_heartbeat(){var self=this;self.got_activity();if(self.dead)return self.log.debug("Skip heartbeat processing for dead feed");self.emit("heartbeat");if(self.dead)return self.log.debug("No wait: heartbeat listener stopped this feed");self.wait()};Feed.prototype.on_couch_data=function on_couch_data(change){var self=this;self.log.debug("Data from "+self.pending.request.id());self.got_activity();if(self.dead)return self.log.debug("Skip data processing for dead feed");change=JSON.parse(change);if("last_seq"in change){self.log.warn("Stopping upon receiving a final message: "+JSON.stringify(change));var del_er=new Error("Database deleted after change: "+change.last_seq);del_er.deleted=true;del_er.last_seq=change.last_seq;return self.die(del_er)}if(!change.seq)return self.die(new Error("Change has no .seq field: "+JSON.stringify(change)));self.on_change(change);if(self.dead)return self.log.debug("No wait: change listener stopped this feed");self.wait()};Feed.prototype.on_timeout=function on_timeout(){var self=this;self.log.debug("Timeout");var now=new Date;var elapsed_ms=now-self.pending.activity_at;self.emit("timeout",{elapsed_ms:elapsed_ms,heartbeat:self.heartbeat,id:self.pending.request.id()});destroy_req(self.pending.request);self.retry()};Feed.prototype.retry=function retry(){var self=this;clearTimeout(self.pending.wait_timer);self.pending.wait_timer=null;self.log.debug("Retry since="+self.since+" after "+self.retry_delay+"ms ");self.emit("retry",{since:self.since,after:self.retry_delay,db:self.db_safe});self.retry_timer=setTimeout(function(){self.query()},self.retry_delay);var max_retry_ms=self.max_retry_seconds*1e3;self.retry_delay*=2;if(self.retry_delay>max_retry_ms)self.retry_delay=max_retry_ms};Feed.prototype.on_couch_end=function on_couch_end(){var self=this;self.log.debug("Changes feed ended "+self.pending.request.id());self.pending.request=null;return self.retry()};Feed.prototype.on_couch_error=function on_couch_error(er){var self=this;self.log.debug("Changes query eror: "+lib.JS(er.stack));return self.retry()};Feed.prototype.stop=function(val){var self=this;self.log.debug("Stop");self.die();self.emit("stop",val)};Feed.prototype.die=function(er){var self=this;if(er)self.log.fatal("Fatal error: "+er.stack);self.dead=true;clearTimeout(self.retry_timer);clearTimeout(self.inactivity_timer);clearTimeout(self.pending.wait_timer);self.inactivity_timer=null;self.pending.wait_timer=null;var req=self.pending.request;self.pending.request=null;if(req){self.log.debug("Destroying req "+req.id());destroy_req(req)}if(er)self.emit("error",er)};Feed.prototype.on_change=function on_change(change){var self=this;if(!change.seq)return self.die(new Error("No seq value in change: "+lib.JS(change)));if(change.seq<=self.since){self.log.debug("Bad seq value "+change.seq+" since="+self.since);return destroy_req(self.pending.request)}if(!self.caught_up&&change.seq>=self.original_db_seq){self.caught_up=true;self.emit("catchup",change.seq)}if(typeof self.filter!=="function")return self.on_good_change(change);if(!change.doc)return self.die(new Error("Internal filter needs .doc in change "+change.seq));var doc=lib.JDUP(change.doc);var req=lib.JDUP({query:self.pending.request.changes_query});var result=false;try{result=self.filter.apply(null,[doc,req])}catch(er){self.log.debug("Filter error",er)}result=result&&true||false;if(result){self.log.debug("Builtin filter PASS for change: "+change.seq);return self.on_good_change(change)}else self.log.debug("Builtin filter FAIL for change: "+change.seq)};Feed.prototype.on_good_change=function on_good_change(change){var self=this;if(self.inactivity_ms&&!self.inactivity_timer)return self.die(new Error("Cannot find inactivity timer during change"));clearTimeout(self.inactivity_timer);self.inactivity_timer=null;if(self.inactivity_ms)self.inactivity_timer=setTimeout(function(){self.on_inactivity()},self.inactivity_ms);self.change_at=new Date;self.since=change.seq;self.emit("change",change)};Feed.prototype.on_inactivity=function on_inactivity(){var self=this;var now=new Date;var elapsed_ms=now-self.change_at;var elapsed_s=elapsed_ms/1e3;return self.die(new Error("Req "+self.pending.request.id()+" made no changes for "+elapsed_s+"s"))};module.exports={Feed:Feed};function destroy_req(req){if(req)destroy_response(req.response);if(req&&typeof req.destroy=="function")req.destroy()}function destroy_response(response){if(!response)return;if(typeof response.abort==="function")response.abort();if(response.connection)response.connection.destroy()}},{"../lib":11,"./stream":12,__browserify_process:38,events:27,querystring:30,request:7,util:32}],11:[function(require,module,exports){var process=require("__browserify_process");module.require=require;exports.scrub_creds=function scrub_creds(url){return url.replace(/^(https?:\/\/)[^:]+:[^@]+@(.*)$/,"$1$2")};exports.JP=JSON.parse;exports.JS=JSON.stringify;exports.JDUP=function(obj){return JSON.parse(JSON.stringify(obj))};var timeouts={setTimeout:setTimeout,clearTimeout:clearTimeout};exports.setTimeout=function(){return timeouts.setTimeout.apply(this,arguments)};exports.clearTimeout=function(){return timeouts.clearTimeout.apply(this,arguments)};exports.timeouts=function(set,clear){timeouts.setTimeout=set;timeouts.clearTimeout=clear};var VERBOSE;if(require.isBrowser)VERBOSE=true;else VERBOSE=process.env.verbose==="true";var noop=function(){};if(process.env.TAP_DIAG)noop=console.error;function noops(){return{trace:noop,debug:VERBOSE?console.log:noop,info:VERBOSE?console.info:noop,warn:VERBOSE?console.warn:noop,error:VERBOSE?console.error:noop,fatal:VERBOSE?console.error:noop,level:{level:0,levelStr:"noop"},setLevel:noop}}try{if(!process.env.log_plain)exports.log4js=require("log4js")}catch(e){exports.log4js=null}exports.log4js=exports.log4js||{getLogger:function(){return noops()}}},{__browserify_process:38,log4js:18}],12:[function(require,module,exports){var process=require("__browserify_process"),Buffer=require("__browserify_Buffer").Buffer;module.require=require;var lib=require("../lib"),util=require("util"),stream=require("stream"),request=require("request");var setTimeout=lib.setTimeout,clearTimeout=lib.clearTimeout;var DEFS={longpoll_header:'{"results":[',log_level:process.env.follow_log_level||"info"};module.exports={Changes:Changes};util.inherits(Changes,stream);function Changes(opts){var self=this;stream.call(self);self.readable=true;self.writable=true;self.headers={};self.statusCode=null;opts=opts||{};self.feed=opts.feed||null;self.encoding=opts.encoding||"utf8";self.log=opts.log;if(!self.log){self.log=lib.log4js.getLogger("change_stream");self.log.setLevel(DEFS.log_level)}self.is_sending=true;self.is_ending=false;self.is_dead=false;self.source=null;self.expect=null;self.buf=null;self.changes=[];self.on("pipe",function(src){if(!self.source)self.source=src;else{var er=new Error("Already have a pipe source");er.source=self.source;self.error(er)}})}Changes.prototype.setHeader=function(key,val){var self=this;self.headers[key]=val};Changes.prototype.setEncoding=function(encoding){var self=this;self.encoding=encoding};Changes.prototype.pause=function(){var self=this;self.is_sending=false;if(self.source&&self.source.pause)self.source.pause()};Changes.prototype.resume=function(){var self=this;self.is_sending=true;if(self.source&&self.source.resume)self.source.resume();self.emit_changes()};Changes.prototype.write=function(data,encoding){var self=this;data=self.normalize_data(data,encoding);if(typeof data!="string")return;if(self.feed==="longpoll")return self.write_longpoll(data);else if(self.feed==="continuous")return self.write_continuous(data)};Changes.prototype.write_longpoll=function(data){var self=this;if(self.buf===null)self.buf=[];self.buf.push(data);return true};Changes.prototype.write_continuous=function(data){var self=this;var offset,json,change,buf=(self.buf||"")+data;self.log.debug("write: "+util.inspect({data:data,buf:buf}));while((offset=buf.indexOf("\n"))>=0){json=buf.substr(0,offset);buf=buf.substr(offset+1);self.log.debug("JSON: "+util.inspect(json));if(json==="");else if(json[0]!=="{")return self.error(new Error("Non-object JSON data: "+json));else{try{change=JSON.parse(json)}catch(er){return self.error(er)}self.log.debug("Object: "+util.inspect(change));json=JSON.stringify(change)}self.changes.push(json)}var was_sending=self.is_sending;self.buf=buf;self.emit_changes();return was_sending};Changes.prototype.end=function(data,encoding){var self=this;self.is_ending=true;self.writable=false;self.write(data,encoding);if(self.feed==="longpoll"){var changes=[DEFS.longpoll_header].concat(self.buf).join("");try{changes=JSON.parse(changes)||{}}catch(er){return self.error(er)}if(!Array.isArray(changes.results))return self.error(new Error('No "results" field in feed'));if(self.changes.length!==0)return self.error(new Error("Changes are already queued: "+JSON.stringify(self.changes)));self.changes=changes.results.map(function(change){return JSON.stringify(change)});return self.emit_changes()}else if(self.feed==="continuous"){if(self.buf!=="")self.log.debug('Unprocessed data after "end" called: '+util.inspect(self.buf))}};Changes.prototype.emit_changes=function(){var self=this;while(self.is_sending&&self.changes.length>0){var change=self.changes.shift();if(change===""){self.log.debug("emit: heartbeat");self.emit("heartbeat")}else{self.log.debug("emit: data");self.emit("data",change)}}if(self.is_sending&&self.is_ending&&self.changes.length===0){self.is_ending=false;self.readable=false;self.log.debug("emit: end");self.emit("end")}};Changes.prototype.destroy=function(){var self=this;self.log.debug("destroy");self.is_dead=true;self.is_ending=false;self.is_sending=false;if(self.source&&typeof self.source.destroy==="function")self.source.destroy();if(self.source&&self.source.__isRequestRequest&&self.source.response&&typeof self.source.response.destroy==="function")self.source.response.destroy()};Changes.prototype.destroySoon=function(){var self=this;throw new Error("not implemented")};Changes.prototype.normalize_data=function(data,encoding){var self=this;if(data instanceof Buffer)data=data.toString(encoding);else if(typeof data==="undefined"&&typeof encoding==="undefined")data="";if(typeof data!="string")return self.error(new Error("Not a string or Buffer: "+util.inspect(data)));if(self.feed!=="continuous"&&self.feed!=="longpoll")return self.error(new Error('Must set .feed to "continuous" or "longpoll" before writing data'));if(self.expect===null)self.expect=self.feed=="longpoll"?DEFS.longpoll_header:"";var prefix=data.substr(0,self.expect.length);data=data.substr(prefix.length);var expected_part=self.expect.substr(0,prefix.length),expected_remainder=self.expect.substr(expected_part.length);if(prefix!==expected_part)return self.error(new Error("Prefix not expected "+util.inspect(expected_part)+": "+util.inspect(prefix)));self.expect=expected_remainder;return data};Changes.prototype.error=function(er){var self=this;self.readable=false;self.writable=false;self.emit("error",er);return false}},{"../lib":11,__browserify_Buffer:37,__browserify_process:38,request:7,stream:31,util:32}],13:[function(require,module,exports){var layouts=require("../layouts"),consoleLog=console.log;function consoleAppender(layout){layout=layout||layouts.colouredLayout;return function(loggingEvent){consoleLog(layout(loggingEvent))}}function configure(config){var layout;if(config.layout){layout=layouts.layout(config.layout.type,config.layout)}return consoleAppender(layout)}exports.appender=consoleAppender;exports.configure=configure},{"../layouts":16}],14:[function(require,module,exports){var levels=require("./levels");function getLogger(logger4js,options){if("object"==typeof options){options=options||{}}else if(options){options={format:options}}else{options={}}var thislogger=logger4js,level=levels.toLevel(options.level,levels.INFO),fmt=options.format||':remote-addr - - ":method :url HTTP/:http-version" :status :content-length ":referrer" ":user-agent"',nolog=options.nolog?createNoLogCondition(options.nolog):null;return function(req,res,next){if(req._logging)return next();if(nolog&&nolog.test(req.originalUrl))return next();if(thislogger.isLevelEnabled(level)){var start=+new Date,statusCode,writeHead=res.writeHead,end=res.end,url=req.originalUrl;req._logging=true;res.writeHead=function(code,headers){res.writeHead=writeHead;res.writeHead(code,headers);res.__statusCode=statusCode=code;res.__headers=headers||{}};res.end=function(chunk,encoding){res.end=end;res.end(chunk,encoding);res.responseTime=+new Date-start;if("function"==typeof fmt){var line=fmt(req,res,function(str){return format(str,req,res)});if(line)thislogger.log(level,line)}else{thislogger.log(level,format(fmt,req,res))}}}next()}}function format(str,req,res){return str.replace(":url",req.originalUrl).replace(":method",req.method).replace(":status",res.__statusCode||res.statusCode).replace(":response-time",res.responseTime).replace(":date",(new Date).toUTCString()).replace(":referrer",req.headers["referer"]||req.headers["referrer"]||"").replace(":http-version",req.httpVersionMajor+"."+req.httpVersionMinor).replace(":remote-addr",req.socket&&(req.socket.remoteAddress||req.socket.socket&&req.socket.socket.remoteAddress)).replace(":user-agent",req.headers["user-agent"]||"").replace(":content-length",res._headers&&res._headers["content-length"]||res.__headers&&res.__headers["Content-Length"]||"-").replace(/:req\[([^\]]+)\]/g,function(_,field){return req.headers[field.toLowerCase()]}).replace(/:res\[([^\]]+)\]/g,function(_,field){return res._headers?res._headers[field.toLowerCase()]||res.__headers[field]:res.__headers&&res.__headers[field]})}function createNoLogCondition(nolog,type){if(!nolog)return null;type=type||"";if(nolog instanceof RegExp){if(type==="string")return nolog.source;return nolog}else if(typeof nolog==="string"){if(type==="string")return nolog;try{return new RegExp(nolog)}catch(ex){return null}}else if(nolog instanceof Array){var regexps=nolog.map(function(o){return createNoLogCondition(o,"string")});return new RegExp(regexps.join("|"))}}exports.connectLogger=getLogger},{"./levels":17}],15:[function(require,module,exports){exports.ISO8601_FORMAT="yyyy-MM-dd hh:mm:ss.SSS";exports.ISO8601_WITH_TZ_OFFSET_FORMAT="yyyy-MM-ddThh:mm:ssO";exports.DATETIME_FORMAT="dd MM yyyy hh:mm:ss.SSS";exports.ABSOLUTETIME_FORMAT="hh:mm:ss.SSS";exports.asString=function(date){var format=exports.ISO8601_FORMAT;if(typeof date==="string"){format=arguments[0];date=arguments[1]}var vDay=addZero(date.getDate());var vMonth=addZero(date.getMonth()+1);var vYearLong=addZero(date.getFullYear());var vYearShort=addZero(date.getFullYear().toString().substring(3,4));var vYear=format.indexOf("yyyy")>-1?vYearLong:vYearShort;var vHour=addZero(date.getHours());var vMinute=addZero(date.getMinutes());var vSecond=addZero(date.getSeconds());var vMillisecond=padWithZeros(date.getMilliseconds(),3);var vTimeZone=offset(date);var formatted=format.replace(/dd/g,vDay).replace(/MM/g,vMonth).replace(/y{1,4}/g,vYear).replace(/hh/g,vHour).replace(/mm/g,vMinute).replace(/ss/g,vSecond).replace(/SSS/g,vMillisecond).replace(/O/g,vTimeZone);return formatted;function padWithZeros(vNumber,width){var numAsString=vNumber+"";while(numAsString.length<width){numAsString="0"+numAsString}return numAsString}function addZero(vNumber){return padWithZeros(vNumber,2)}function offset(date){var os=Math.abs(date.getTimezoneOffset());var h=String(Math.floor(os/60));var m=String(os%60);h.length==1?h="0"+h:1;m.length==1?m="0"+m:1;return date.getTimezoneOffset()<0?"+"+h+m:"-"+h+m}}},{}],16:[function(require,module,exports){var dateFormat=require("./date_format"),os=require("os"),eol=os.EOL||"\n",util=require("util"),replacementRegExp=/%[sdj]/g,layoutMakers={messagePassThrough:function(){return messagePassThroughLayout},basic:function(){return basicLayout},colored:function(){return colouredLayout},coloured:function(){return colouredLayout},pattern:function(config){var pattern=config.pattern||undefined;var tokens=config.tokens||undefined;return patternLayout(pattern,tokens)}},colours={ALL:"grey",TRACE:"blue",DEBUG:"cyan",INFO:"green",WARN:"yellow",ERROR:"red",FATAL:"magenta",OFF:"grey"};function formatLogData(logData){var output="",data=Array.isArray(logData)?logData.slice():Array.prototype.slice.call(arguments),format=data.shift();if(typeof format==="string"){output=format.replace(replacementRegExp,function(match){switch(match){case"%s":return new String(data.shift());case"%d":return new Number(data.shift());case"%j":return JSON.stringify(data.shift());default:return match}})}else{data.unshift(format)}data.forEach(function(item){if(output){output+=" "}output+=util.inspect(item);if(item&&item.stack){output+="\n"+item.stack}});return output}var styles={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[90,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};function colorizeStart(style){return style?"["+styles[style][0]+"m":""}function colorizeEnd(style){return style?"["+styles[style][1]+"m":""}function colorize(str,style){return colorizeStart(style)+str+colorizeEnd(style)}function timestampLevelAndCategory(loggingEvent,colour){var output=colorize(formatLogData("[%s] [%s] %s - ",dateFormat.asString(loggingEvent.startTime),loggingEvent.level,loggingEvent.categoryName),colour);return output}function basicLayout(loggingEvent){return timestampLevelAndCategory(loggingEvent)+formatLogData(loggingEvent.data)}function colouredLayout(loggingEvent){return timestampLevelAndCategory(loggingEvent,colours[loggingEvent.level.toString()])+formatLogData(loggingEvent.data)}function messagePassThroughLayout(loggingEvent){return formatLogData(loggingEvent.data)}function patternLayout(pattern,tokens){var TTCC_CONVERSION_PATTERN="%r %p %c - %m%n";var regex=/%(-?[0-9]+)?(\.?[0-9]+)?([\[\]cdmnprx%])(\{([^\}]+)\})?|([^%]+)/;pattern=pattern||TTCC_CONVERSION_PATTERN;return function(loggingEvent){var formattedString="";var result;var searchString=pattern;while(result=regex.exec(searchString)){var matchedString=result[0];var padding=result[1];var truncation=result[2];var conversionCharacter=result[3];var specifier=result[5];var text=result[6];if(text){formattedString+=""+text}else{var replacement="";switch(conversionCharacter){case"c":var loggerName=loggingEvent.categoryName;if(specifier){var precision=parseInt(specifier,10);var loggerNameBits=loggingEvent.categoryName.split(".");if(precision>=loggerNameBits.length){replacement=loggerName}else{replacement=loggerNameBits.slice(loggerNameBits.length-precision).join(".")}}else{replacement=loggerName}break;case"d":var format=dateFormat.ISO8601_FORMAT;if(specifier){format=specifier;if(format=="ISO8601"){format=dateFormat.ISO8601_FORMAT}else if(format=="ABSOLUTE"){format=dateFormat.ABSOLUTETIME_FORMAT}else if(format=="DATE"){format=dateFormat.DATETIME_FORMAT}}replacement=dateFormat.asString(format,loggingEvent.startTime);break;case"m":replacement=formatLogData(loggingEvent.data);break;case"n":replacement=eol;break;case"p":replacement=loggingEvent.level.toString();break;case"r":replacement=""+loggingEvent.startTime.toLocaleTimeString();break;case"[":replacement=colorizeStart(colours[loggingEvent.level.toString()]);break;case"]":replacement=colorizeEnd(colours[loggingEvent.level.toString()]);break;case"%":replacement="%";break;case"x":if(typeof tokens[specifier]!=="undefined"){if(typeof tokens[specifier]==="function"){replacement=tokens[specifier]()}else{replacement=tokens[specifier]}}else{replacement=matchedString}break;default:replacement=matchedString;break}var len;if(truncation){len=parseInt(truncation.substr(1),10);replacement=replacement.substring(0,len)}if(padding){if(padding.charAt(0)=="-"){len=parseInt(padding.substr(1),10);while(replacement.length<len){replacement+=" "}}else{len=parseInt(padding,10);while(replacement.length<len){replacement=" "+replacement}}}formattedString+=replacement}searchString=searchString.substr(result.index+result[0].length)}return formattedString}}module.exports={basicLayout:basicLayout,messagePassThroughLayout:messagePassThroughLayout,patternLayout:patternLayout,colouredLayout:colouredLayout,coloredLayout:colouredLayout,layout:function(name,config){return layoutMakers[name]&&layoutMakers[name](config)}}},{"./date_format":15,os:36,util:32}],17:[function(require,module,exports){function Level(level,levelStr){this.level=level;this.levelStr=levelStr}function toLevel(sArg,defaultLevel){if(!sArg){return defaultLevel}if(typeof sArg=="string"){var s=sArg.toUpperCase();if(module.exports[s]){return module.exports[s]}else{return defaultLevel}}return toLevel(sArg.toString())}Level.prototype.toString=function(){return this.levelStr};Level.prototype.isLessThanOrEqualTo=function(otherLevel){if(typeof otherLevel==="string"){otherLevel=toLevel(otherLevel)}return this.level<=otherLevel.level};Level.prototype.isGreaterThanOrEqualTo=function(otherLevel){if(typeof otherLevel==="string"){otherLevel=toLevel(otherLevel)}return this.level>=otherLevel.level};Level.prototype.isEqualTo=function(otherLevel){if(typeof otherLevel=="string"){otherLevel=toLevel(otherLevel)}return this.level===otherLevel.level};module.exports={ALL:new Level(Number.MIN_VALUE,"ALL"),TRACE:new Level(5e3,"TRACE"),DEBUG:new Level(1e4,"DEBUG"),INFO:new Level(2e4,"INFO"),WARN:new Level(3e4,"WARN"),ERROR:new Level(4e4,"ERROR"),FATAL:new Level(5e4,"FATAL"),OFF:new Level(Number.MAX_VALUE,"OFF"),toLevel:toLevel}},{}],18:[function(require,module,exports){var process=require("__browserify_process");var events=require("events"),fs=require("fs"),path=require("path"),util=require("util"),layouts=require("./layouts"),levels=require("./levels"),LoggingEvent=require("./logger").LoggingEvent,Logger=require("./logger").Logger,ALL_CATEGORIES="[all]",appenders={},loggers={},appenderMakers={},defaultConfig={appenders:[{type:"console"}],replaceConsole:false};function getLogger(categoryName){if(!(typeof categoryName=="string")){categoryName=Logger.DEFAULT_CATEGORY
}var appenderList;if(!loggers[categoryName]){loggers[categoryName]=new Logger(categoryName);if(appenders[categoryName]){appenderList=appenders[categoryName];appenderList.forEach(function(appender){loggers[categoryName].addListener("log",appender)})}if(appenders[ALL_CATEGORIES]){appenderList=appenders[ALL_CATEGORIES];appenderList.forEach(function(appender){loggers[categoryName].addListener("log",appender)})}}return loggers[categoryName]}function addAppender(){var args=Array.prototype.slice.call(arguments);var appender=args.shift();if(args.length==0||args[0]===undefined){args=[ALL_CATEGORIES]}if(Array.isArray(args[0])){args=args[0]}args.forEach(function(category){if(!appenders[category]){appenders[category]=[]}appenders[category].push(appender);if(category===ALL_CATEGORIES){for(var logger in loggers){if(loggers.hasOwnProperty(logger)){loggers[logger].addListener("log",appender)}}}else if(loggers[category]){loggers[category].addListener("log",appender)}})}function clearAppenders(){appenders={};for(var logger in loggers){if(loggers.hasOwnProperty(logger)){loggers[logger].removeAllListeners("log")}}}function configureAppenders(appenderList,options){clearAppenders();if(appenderList){appenderList.forEach(function(appenderConfig){loadAppender(appenderConfig.type);var appender;appenderConfig.makers=appenderMakers;appender=appenderMakers[appenderConfig.type](appenderConfig,options);if(appender){addAppender(appender,appenderConfig.category)}else{throw new Error("log4js configuration problem for "+util.inspect(appenderConfig))}})}}function configureLevels(levels){if(levels){for(var category in levels){if(levels.hasOwnProperty(category)){getLogger(category).setLevel(levels[category])}}}}function setGlobalLogLevel(level){Logger.prototype.level=levels.toLevel(level,levels.TRACE)}function getDefaultLogger(){return getLogger(Logger.DEFAULT_CATEGORY)}var configState={};function loadConfigurationFile(filename){if(filename&&(!configState.lastFilename||filename!==configState.lastFilename||!configState.lastMTime||fs.statSync(filename).mtime!==configState.lastMTime)){configState.lastFilename=filename;configState.lastMTime=fs.statSync(filename).mtime;return JSON.parse(fs.readFileSync(filename,"utf8"))}return undefined}function configureOnceOff(config,options){if(config){try{configureAppenders(config.appenders,options);configureLevels(config.levels);if(config.replaceConsole){replaceConsole()}else{restoreConsole()}}catch(e){throw new Error("Problem reading log4js config "+util.inspect(config)+'. Error was "'+e.message+'" ('+e.stack+")")}}}function reloadConfiguration(){var filename=configState.filename,mtime;if(!filename){return}try{mtime=fs.statSync(filename).mtime}catch(e){getLogger("log4js").warn("Failed to load configuration file "+filename);return}if(configState.lastFilename&&configState.lastFilename===filename){if(mtime.getTime()>configState.lastMTime.getTime()){configureOnceOff(loadConfigurationFile(filename))}}else{configureOnceOff(loadConfigurationFile(filename))}}function initReloadConfiguration(filename,options){if(configState.timerId){clearInterval(configState.timerId);delete configState.timerId}configState.filename=filename;configState.timerId=setInterval(reloadConfiguration,options.reloadSecs*1e3)}function configure(configurationFileOrObject,options){var config=configurationFileOrObject;config=config||process.env.LOG4JS_CONFIG;options=options||{};if(config===undefined||config===null||typeof config==="string"){if(options.reloadSecs){initReloadConfiguration(config,options)}config=loadConfigurationFile(config)||defaultConfig}else{if(options.reloadSecs){getLogger("log4js").warn('Ignoring configuration reload parameter for "object" configuration.')}}configureOnceOff(config,options)}var originalConsoleFunctions={log:console.log,debug:console.debug,info:console.info,warn:console.warn,error:console.error};function replaceConsole(logger){function replaceWith(fn){return function(){fn.apply(logger,arguments)}}logger=logger||getLogger("console");["log","debug","info","warn","error"].forEach(function(item){console[item]=replaceWith(item==="log"?logger.info:logger[item])})}function restoreConsole(){["log","debug","info","warn","error"].forEach(function(item){console[item]=originalConsoleFunctions[item]})}function loadAppender(appender){var appenderModule;try{appenderModule=require("./appenders/console.js")}catch(e){appenderModule=require(appender)}module.exports.appenders[appender]=appenderModule.appender.bind(appenderModule);appenderMakers[appender]=appenderModule.configure.bind(appenderModule)}module.exports={getLogger:getLogger,getDefaultLogger:getDefaultLogger,addAppender:addAppender,loadAppender:loadAppender,clearAppenders:clearAppenders,configure:configure,replaceConsole:replaceConsole,restoreConsole:restoreConsole,levels:levels,setGlobalLogLevel:setGlobalLogLevel,layouts:layouts,appenders:{},appenderMakers:appenderMakers,connectLogger:require("./connect-logger").connectLogger};configure()},{"./appenders/console.js":13,"./connect-logger":14,"./layouts":16,"./levels":17,"./logger":19,__browserify_process:38,events:27,fs:28,path:29,util:32}],19:[function(require,module,exports){var levels=require("./levels"),util=require("util"),events=require("events"),DEFAULT_CATEGORY="[default]";function LoggingEvent(categoryName,level,data,logger){this.startTime=new Date;this.categoryName=categoryName;this.data=data;this.level=level;this.logger=logger}function Logger(name,level){this.category=name||DEFAULT_CATEGORY;if(!this.level){this.__proto__.level=levels.TRACE}}util.inherits(Logger,events.EventEmitter);Logger.DEFAULT_CATEGORY=DEFAULT_CATEGORY;Logger.prototype.setLevel=function(level){this.level=levels.toLevel(level,this.level||levels.TRACE)};Logger.prototype.removeLevel=function(){delete this.level};Logger.prototype.log=function(){var args=Array.prototype.slice.call(arguments),logLevel=args.shift(),loggingEvent=new LoggingEvent(this.category,logLevel,args,this);this.emit("log",loggingEvent)};Logger.prototype.isLevelEnabled=function(otherLevel){return this.level.isLessThanOrEqualTo(otherLevel)};["Trace","Debug","Info","Warn","Error","Fatal"].forEach(function(levelString){var level=levels.toLevel(levelString);Logger.prototype["is"+levelString+"Enabled"]=function(){return this.isLevelEnabled(level)};Logger.prototype[levelString.toLowerCase()]=function(){if(this.isLevelEnabled(level)){var args=Array.prototype.slice.call(arguments);args.unshift(level);Logger.prototype.log.apply(this,args)}}});exports.LoggingEvent=LoggingEvent;exports.Logger=Logger},{"./levels":17,events:27,util:32}],20:[function(require,module,exports){module.exports=require("./lib/txn")},{"./lib/txn":22}],21:[function(require,module,exports){var process=require("__browserify_process");module.require=require;var assert=require("assert"),log4js=require("log4js"),request_mod=require("request");require("defaultable")(module,{request:request_mod},function(module,exports,DEFS,require){module.exports={JP:JP,JS:JS,JDUP:JDUP,strictSSL:true,enc_id:encode_doc_id,req_json:req_json,req_couch:req_couch};var REQUEST_TIMEOUT_MS=6e4;function JP(){return JSON.parse.apply(this,arguments)}function JS(){return JSON.stringify.apply(this,arguments)}function JDUP(obj){return JSON.parse(JSON.stringify(obj))}function encode_doc_id(id){return encodeURIComponent(id).replace(/^_design%2[fF]/,"_design/")}function req_couch(opts,callback){assert.ok(callback);if(process.env.couch_proxy)opts.proxy=process.env.couch_proxy;return req_json(opts,function(er,resp,result){if(resp&&result&&(resp.statusCode<200||resp.statusCode>299)&&result.error)er=er||new Error("CouchDB error: "+JS(result));if(er){er.statusCode=resp&&resp.statusCode;Object.keys(result||{}).forEach(function(key){er[key]=result[key]})}return callback(er,resp,result)})}function req_json(opts,callback){assert.ok(callback);opts=JDUP(opts);opts.followRedirect=false;opts.strictSSL=DEFS.strictSSL;opts.headers=opts.headers||{};opts.headers["accept"]=opts.headers["accept"]||"application/json";if(opts.method&&opts.method!=="GET")opts.headers["content-type"]="application/json";var LOG=opts.log||log4js.getLogger("txn");LOG.setLevel(process.env.txn_log_level||"info");if(opts.json)opts.body=JS(opts.json);delete opts.json;var in_flight=null;var timed_out=false;var timer=setTimeout(on_timeout,REQUEST_TIMEOUT_MS);function on_timeout(){timed_out=true;var msg="Timeout: "+JS(opts);LOG.warn(msg);if(in_flight&&in_flight.end)in_flight.end();if(in_flight&&in_flight.response&&in_flight.response.destroy)in_flight.response.destroy();return callback(new Error(msg))}var method=opts.method||"GET";LOG.debug(method+" "+opts.uri);in_flight=DEFS.request(opts,function(er,resp,body){clearTimeout(timer);if(timed_out){LOG.debug("Ignoring timed-out response: "+opts.uri);return}if(!er){try{body=JSON.parse(body)}catch(j_er){var err=new Error("Response was not JSON (or not valid)");return callback(err,resp,body)}}return callback(er,resp,body)});return in_flight}})},{__browserify_process:38,assert:26,defaultable:8,log4js:18,request:7}],22:[function(require,module,exports){var process=require("__browserify_process");module.require=require;var util=require("util"),log4js=require("log4js"),events=require("events"),assert=require("assert"),obj_diff=require("obj_diff");require("defaultable").def(module,{log:log4js.getLogger("txn"),log_level:process.env.txn_log_level||"info",timestamps:false,timestamp_generator:function(){return new Date},create:false,max_tries:5,after:null,delay:100,timeout:15*1e3,operation:null,strictSSL:true,req:null,couch:null,db:null,id:null},function(module,exports,DEFAULT,require){var lib=require("./lib");var api=couch_doc_txn;api.Txn=api.Transaction=Transaction;module.exports=api;function couch_doc_txn(fetch_req,operation,callback){assert.equal("function",typeof callback,"Need callback");var opts={};for(var key in DEFAULT)if(key!=="req"&&key!=="operation")if(key in fetch_req){opts[key]=fetch_req[key];delete fetch_req[key]}if(fetch_req.doc){opts.doc=fetch_req.doc;delete fetch_req.doc}opts.req=fetch_req;opts.operation=operation;var txn=new Transaction(opts);txn.on("timeout",function(){var err=new Error("Transaction ("+txn.name+") timeout");err.timeout=true;return callback(err)});txn.on("exhausted",function(tries){var err=new Error("Transaction ("+txn.name+") exhausted after "+tries+" conflicts");err.conflict=true;err.tries=tries;return callback(err)});txn.on("error",function(er){return callback(er)});txn.on("done",function(doc){process.nextTick(function(){callback(null,doc,txn)})});txn.start();return txn}var EventEmitter=events.EventEmitter2||events.EventEmitter;util.inherits(Transaction,EventEmitter);function Transaction(opts){var self=this;EventEmitter.call(self);self.req=opts.req||DEFAULT.req;self.couch=opts.couch||DEFAULT.couch;self.db=opts.db||DEFAULT.db;self.id=opts.id||DEFAULT.id;self.doc=opts.doc||null;self.operation=opts.operation||DEFAULT.operation;self.timeout=opts.timeout||DEFAULT.timeout;self.delay=opts.delay||DEFAULT.delay;self.log=opts.log||DEFAULT.log;self.timestamp_generator=opts.timestamp_generator||DEFAULT.timestamp_generator;self.log.setLevel(DEFAULT.log_level);self.after="after"in opts?opts.after:DEFAULT.after;self.create="create"in opts?opts.create:DEFAULT.create;self.timestamps="timestamps"in opts?opts.timestamps:DEFAULT.timestamps;self.max_tries="max_tries"in opts?opts.max_tries:DEFAULT.max_tries}Transaction.prototype.start=function(){var self=this;if(!self.req)return self.emit("error",new Error("Required req object"));if(self.doc&&!self.doc._id)return self.emit("error",new Error("Required doc._id value"));if(self.doc)self.id=self.doc._id;if(self.id)self.id=lib.enc_id(self.id);var has_uri=!!(self.req.uri||self.req.url);var has_couch=!!(self.couch||self.db||self.id);assert.ok(has_uri||has_couch,"Must provide .uri or .couch/.db/.id parameters");if(has_uri)assert.equal(false,has_couch,"Clashing .uri/.url and .couch/.db/.id parameters");if(has_couch){assert.ok(self.couch&&self.db&&self.id,"Must set all .couch, .db, and .id parameters");assert.equal(false,has_uri,"Clashing .uri/.url and .couch/.db/.id parameters")}self.uri=self.req.uri||self.req.url||[self.couch,self.db,self.id].join("/");assert.ok(self.uri,"Must set .uri or else .couch, .db, and .id");assert.ok(self.max_tries>0,"max_tries must be 1 or greater");assert.ok(self.timeout>0,"timeout must be 1 or greater");assert.equal(typeof self.operation,"function","Data operation required");self.name=self.operation.name||"Untitled";self.fetches=0;self.stores=0;self.tries=0;return self.attempt()};Transaction.prototype.attempt=function(){var self=this;if(self.tries>=self.max_tries){self.log.debug("Too many tries ("+self.name+"): "+self.tries);return self.emit("exhausted",self.tries)}if(self.retry_timer)return self.emit("error",new Error("retry_timer already set: "+self.name));var delay;if(self.tries==0&&!self.after)return go();else if(self.tries==0&&self.after){delay=self.after;self.log.debug("Initial delay before first run ("+self.name+"): "+delay);self.retry_timer=setTimeout(go,delay)}else{delay=self.delay*Math.pow(2,self.tries);self.log.debug("Delay until next attempt ("+self.name+"): "+delay);self.retry_timer=setTimeout(go,delay)}function go(){clearTimeout(self.retry_timer);delete self.retry_timer;self.tries+=1;self.emit("attempt",self.tries);self.run()}};Transaction.prototype.run=function(){var self=this;self.log.debug("Transaction "+self.name+" ("+self.tries+"/"+self.max_tries+"): "+self.uri);if(self.doc){self.log.debug("Skipping fetch, assuming known doc: "+self.doc._id);run_op(self.doc,!("_rev"in self.doc))}else{self.log.debug("Fetching doc: "+(self.id||self.uri_to_id(self.uri)));self.req.method="GET";self.req.uri=self.uri;delete self.req.url;self.fetches+=1;lib.req_couch(self.req,function(er,resp,couch_doc){var is_create=!!self.create&&resp.statusCode==404&&couch_doc.error=="not_found";if(er&&!is_create)return self.emit("error",er);if(is_create){couch_doc={_id:decodeURIComponent(self.id||self.uri_to_id(self.uri))};self.log.debug("Creating new doc: "+lib.JS(couch_doc))}return run_op(couch_doc,is_create)})}function run_op(doc,is_create){if(!doc._id)return self.emit("error",new Error("No _id: "+lib.JS(doc)));if(!doc._rev&&!is_create)return self.emit("error",new Error("No _rev: "+lib.JS(doc)));delete self.doc;var original={doc:lib.JDUP(doc),id:doc._id,rev:doc._rev};if(self.op_timer)return self.emit("error",new Error("op_timer already set: "+self.name));var already_done=false;self.op_timer=setTimeout(on_timeout,self.timeout);function on_timeout(){self.op_timer=null;already_done=true;return self.emit("timeout")}self.operation(doc,op_done);function op_done(er,new_doc){clearTimeout(self.op_timer);delete self.op_timer;if(already_done){self.log.debug("Ignoring operation after timeout");return self.emit("ignore")}else already_done=true;if(er)return self.emit("error",er);if(new_doc){self.log.debug("Using new doc: "+lib.JS(new_doc));self.emit("replace",doc,new_doc);doc=new_doc}if(obj_diff.atmost(original.doc,doc,{})){self.log.debug("Skipping txn update for unchanged doc: "+original.id);return self.emit("done",doc)}var diff=obj_diff.diff(original.doc,doc);self.log.debug("Operation diff (%s): %j",self.name,diff);self.emit("change",diff);doc._id=original.id;if(original.rev)doc._rev=original.rev;if(!!self.timestamps){doc.updated_at=JSON.stringify(self.timestamp_generator()).replace(/"/g,"");if(is_create)doc.created_at=doc.updated_at}var update_req={method:"PUT",uri:self.uri,json:doc};self.log.debug("Updating transaction ("+self.name+"): "+update_req.uri);self.stores+=1;lib.req_couch(update_req,function(er,resp,result){if(er&&resp&&resp.statusCode===409&&result.error==="conflict"){self.log.debug("Conflict: "+self.name);self.emit("conflict",self.tries);return self.attempt()}if(er)return self.emit("error",er);doc._rev=result.rev;return self.emit("done",doc)})}}};Transaction.prototype.cancel=function(){clearTimeout(self.retry_timer);clearTimeout(self.op_timer);self.log.debug("Cancelling transaction try: "+self.tries);self.retry_timer=null;self.op_timer=null;self.emit("cancel",self.tries)};Transaction.prototype.uri_to_id=function(uri){var parts=uri.split("/");return parts[parts.length-1]}})},{"./lib":21,__browserify_process:38,assert:26,defaultable:8,events:27,log4js:18,obj_diff:23,util:32}],23:[function(require,module,exports){var util=require("util"),diff=require("./diff");var API={diff:diff.doc_diff,atmost:diff.doc_diff_atmost,atleast:diff.doc_diff_atleast};module.exports=API},{"./diff":24,util:32}],24:[function(require,module,exports){var util=require("util");module.exports={doc_diff:doc_diff,doc_diff_atmost:doc_diff_atmost,doc_diff_atleast:doc_diff_atleast};function doc_diff(from,to){var all_keys=Object.keys(from);for(var key in to)if(to.hasOwnProperty(key)&&all_keys.indexOf(key)==-1)all_keys.push(key);var diff={};all_keys.forEach(function(key){var from_val=from[key];var to_val=to[key];if(typeOf(from_val)=="object"&&typeOf(to_val)=="object"){var obj_diff=doc_diff(from_val,to_val);if(!is_equal(obj_diff,{}))diff[key]=obj_diff}else if(!is_equal(from_val,to_val)){diff[key]={from:from_val,to:to_val}}});return diff}function change_matches(allowed_change,from_value,to_value){if(typeOf(allowed_change)!="object")throw new Error("allowed_change must be an object");if(allowed_change.hasOwnProperty("from")&&allowed_change.hasOwnProperty("to")&&is_equal(allowed_change.from,allowed_change.to))throw new Error("This indicates no change at all: "+JSON.stringify(allowed_change));var checker_for=function(change_type){if(!allowed_change.hasOwnProperty(change_type))return function(x){return true};var val=allowed_change[change_type];if(typeOf(val)=="undefined")return function(x){return x===undefined};if(typeOf(val)=="regexp")return function(x){return typeOf(x)=="string"&&val.test(x)};if(val===Array)return function(x){return typeOf(x)=="array"};if(typeOf(val)=="function")return val;return function(x){return is_equal(val,x)}};return checker_for("from")(from_value)&&checker_for("to")(to_value)}function is_change_rule(rule){if(typeOf(rule)!=="object")return false;var keys=Object.keys(rule);if(keys.length==0)return true;if(keys.length==1&&(rule.hasOwnProperty("from")||rule.hasOwnProperty("to")))return true;if(keys.length==2&&rule.hasOwnProperty("from")&&rule.hasOwnProperty("to"))return true;return false}function doc_diff_atmost(from,to,allowed,strict){var diff=doc_diff(from,to);if(!strict&&!allowed.hasOwnProperty("_revisions"))allowed._revisions={ids:{from:Array,to:function(x){return typeOf(x)=="array"&&x.length>0}}};for(var key in diff){if(key!="nest"&&!allowed.hasOwnProperty(key))return false;var rule=allowed[key];if(is_change_rule(rule)){if(!change_matches(rule,diff[key].from,diff[key].to))return false}else{if(!doc_diff_atmost(from[key],to[key],rule))return false}}return true}function doc_diff_atleast(from,to,required){var diff=doc_diff(from,to);for(var key in required){if(key!=="nest"&&!diff.hasOwnProperty(key))return false;var rule=required[key];if(is_change_rule(rule)){if(!change_matches(rule,diff[key].from,diff[key].to))return false}else if(key!=="nest"){if(!doc_diff_atleast(from[key],to[key],rule))return false}}return true}function typeOf(value){var s=typeof value;if(s==="object"){if(!value)s="null";else{if(Object.prototype.toString.apply(value)==="[object Array]"){s="array"}}}else if(s==="function"&&value instanceof RegExp)return"regexp";return s}function is_equal(a,b){var a_type=typeOf(a),b_type=typeOf(b),i;if(a_type!==b_type)return false;else if(a_type==="array"){if(a.length!==b.length)return false;for(i=0;i<a.length;i++)if(!is_equal(a[i],b[i]))return false;return true}else if(a_type=="object"){if(Object.keys(a).length!==Object.keys(b).length)return false;for(i in a)if(!is_equal(a[i],b[i]))return false;return true}else return a===b}},{util:32}],25:[function(require,module,exports){var defaultable=require("defaultable");module.require=require;defaultable(module,{visibility_timeout:30,browser_attachments:false},function(module,exports,DEFS,require){var lib=require("./lib.js"),txn=require("txn"),util=require("util"),couch=require("./couch.js"),assert=require("assert"),message=require("./message.js"),queue_ddoc=require("./ddoc.js"),querystring=require("querystring");var DDOC_ID="_design/cqs";function Queue(opts){var self=this;if(typeof opts=="string")opts={name:opts};opts=defaultable.merge(opts,DEFS);self.name=opts.name||opts.QueueName||opts._str||null;self.time_C=opts.time_C||null;self.db=new couch.Database({couch:opts.couch,db:opts.db,time_C:self.time_C});self.VisibilityTimeout=opts.DefaultVisibilityTimeout||opts.VisibilityTimeout||DEFS.visibility_timeout;self.cache_confirmation=true;self.browser_attachments=!!opts.browser_attachments;self.log=lib.log4js.getLogger("queue/"+(self.name||"untitled"));self.log.setLevel(lib.LOG_LEVEL)}Queue.prototype.confirm=Queue.prototype.confirmed=function after_confirmed(opt,callback){var self=this;if(!callback&&typeof opt==="function"){callback=opt;opt=""}assert.ok(callback);assert.ok(self.db);self.db.confirmed(function(er){if(er)return callback(er);var confirmer=self.db.known_queues[self.name];if(!confirmer||opt==="--force"||!self.cache_confirmation)confirmer=self.db.known_queues[self.name]=new lib.Once;confirmer.on_done(function(er,ddoc){if(er)return callback(er);self.import_ddoc(ddoc);return callback(null,self)});confirmer.job(confirm_queue)});function confirm_queue(done){self.log.debug("Confirming queue: "+self.name);self.db.request(lib.enc_id(DDOC_ID),function(er,res){if(er)return done(er);if(!(self.name in res.body.queues)){if(opt!="--allow-missing")return done(new Error("Queue does not exist: "+self.name));self.log.warn("Using non-existent queue: "+self.name);res.body.queues[self.name]={}}done(null,res.body)})}};Queue.prototype.create=function create_queue(callback){var self=this;assert.ok(callback);self.db.confirmed(function(er){if(er)return callback(er);txn({couch:self.db.couch.url,db:encodeURIComponent(self.db.name),id:DDOC_ID,create:true},add_queue,queue_added)});function add_queue(ddoc,to_txn){var now=new Date;if(!ddoc._rev)ddoc=new queue_ddoc.DDoc;ddoc.queues[self.name]=ddoc.queues[self.name]||{ApproximateNumberOfMessages:0,ApproximateNumberOfMessagesNotVisible:0,VisibilityTimeout:self.VisibilityTimeout||30,CreatedTimestamp:now,LastModifiedTimestamp:now,Policy:null,MaximumMessageSize:8192,MessageRetentionPeriod:345600,QueueArn:null};if(!self.browser_attachments)return to_txn(null,ddoc);else ddoc.add_browser(function(er){return to_txn(er,ddoc)})}function queue_added(er,new_ddoc){if(er)return callback(er);self.log.debug("new_ddoc: %j",new_ddoc._id);self.log.debug("Created queue: "+self.name);self.db.known_queues[self.name]=new lib.Once;self.db.known_queues[self.name].job(function(done){done(null,new_ddoc)});self.import_ddoc(new_ddoc);callback(null,self.name)}};Queue.prototype.import_ddoc=function(ddoc){var self=this;self.ddoc_id=ddoc._id;self.ddoc_rev=ddoc._rev;lib.copy(ddoc.queues[self.name],self,"uppercase")};Queue.prototype.send=function(opts,extra,callback){var self=this;if(!callback&&typeof extra==="function"){callback=extra;extra=null}self.confirmed(function(er){if(er)return callback(er);opts=lib.opt_def(opts);var body=opts._str||opts;var msg=new message.Message({couch:self.couch,db:self.db,queue:self,IdExtra:extra,Body:body});msg.send(callback)})};Queue.prototype.receive=function(opts,callback){var self=this;if(typeof opts==="function"){callback=opts;opts=1}if(typeof opts==="number")opts={MaxNumberOfMessages:opts};var msg_count=opts.MaxNumberOfMessages||1;var vis_timeout=opts.VisibilityTimeout||self.VisibilityTimeout;var is_heartbeat=opts.is_heartbeat||false;assert.ok(msg_count>0,"Message count is too low");assert.ok(msg_count<=10,"Message count is too high");assert.ok(vis_timeout>=0,"Visibility timeout is too low");assert.ok(vis_timeout<=43200,"Visibility timeout is too high");self.confirmed(function(er){if(er)return callback(er);var startkey=lib.JS([self.name,""]);var endkey=lib.JS([self.name,new Date]);var query=querystring.stringify({reduce:false,limit:msg_count,startkey:startkey,endkey:endkey});var path=lib.enc_id(self.ddoc_id)+"/_view/visible_at?"+query;self.db.request(path,function(er,resp,view){if(er)return callback(er);if(view.rows.length===0)return callback(null,[]);var messages=[],count=0;function on_receive(er,pos,msg){if(er&&er.statusCode!=409&&er.error!="conflict"){self.log.debug("Receive error: "+er);return callback(er)}if(er&&er.statusCode==409&&er.error=="conflict"){self.log.debug("Missed message "+pos+": "+msg.MessageId);msg=null}messages[pos]=msg||null;count+=1;if(count===view.rows.length){messages=messages.filter(function(x){return!!x});callback(null,messages)}}view.rows.forEach(function(row,i){var match=new RegExp("^CQS/"+self.name+"/"+"(.+)$").exec(row.value._id);assert.ok(match,"Bad view row: "+lib.JS(row));var msg_opts={};lib.copy(row.value,msg_opts,"uppercase");msg_opts.MessageId=match[1];var msg=new message.Message(msg_opts);msg.queue=self;msg.VisibilityTimeout=vis_timeout;msg.is_heartbeat=is_heartbeat;msg.mvcc={_id:row.value._id,_rev:row.value._rev};msg.receive(function(er){on_receive(er,i,msg)})})})})};Queue.prototype.scrub=function(opts,callback){var self=this;if(typeof callback!="function"||typeof opts!="object")throw new Error("Need options object and callback function");if(typeof opts.match!="function")throw new Error("Need options.match function to evaluate messages");self.confirmed(function(er){if(er)return callback(er);var startkey=lib.JS([self.name,""]);var endkey=lib.JS([self.name,{}]);if(opts.descending){var _tmp=endkey;endkey=startkey;startkey=_tmp}var query={reduce:false,startkey:startkey,endkey:endkey};if(opts.count)query.limit=opts.count;query=querystring.stringify(query);var path=lib.enc_id(self.ddoc_id)+"/_view/visible_at?"+query;self.db.request(path,function(er,resp,view){if(er)return callback(er);var update={docs:[]};for(var i=0;i<view.rows.length;i++){var row=view.rows[i];var msg=row.value.Body;try{var is_match=!!opts.match(msg)}catch(match_er){return callback(match_er)}if(is_match)update.docs.push({_id:row.id,_rev:row.value._rev,_deleted:true})}var found_rows=update.docs.length;self.db.request({method:"POST",uri:"_bulk_docs",json:update},function(er,res){if(er)return callback(er);if(res.statusCode!=201)return callback(new Error("Bad response "+res.statusCode+" to bulk update"));var deleted=0;var conflicts=0;for(var i=0;i<res.body.length;i++){var result=res.body[i];if(result.ok)deleted+=1;else if(result.error=="conflict")conflicts+=1;else return callback(new Error("Unknown update: "+JSON.stringify(result)))}return callback(null,found_rows,deleted,conflicts)})})})};Queue.prototype.set=function set_attrs(opts,callback){var self=this;assert.ok(opts);assert.ok(callback);assert.equal(typeof opts,"object");opts=lib.JDUP(opts);self.log.debug("Set attributes: "+self.name);self.confirmed("--force",function(er){if(er)return callback(er);function go(er){if(er)return callback(er);var req={method:"PUT",uri:lib.enc_id(ddoc._id),json:ddoc};self.db.request(req,function(er,resp,body){if(er)return callback(er)})}});self.db.confirmed(function(er){if(er)return callback(er);txn({couch:self.db.couch.url,db:encodeURIComponent(self.db.name),id:DDOC_ID},update_attrs,attrs_updated)});function update_attrs(ddoc,to_txn){var now=new Date,queue=ddoc.queues[self.name];lib.copy(opts,queue,"uppercase");queue.LastModifiedTimestamp=now;if(!self.browser_attachments)return to_txn();else ddoc.add_browser(to_txn)}function attrs_updated(er,new_ddoc){if(er)return callback(er);self.db.known_queues[self.name]=new lib.Once;self.db.known_queues[self.name].job(function(done){done(null,new_ddoc)});self.import_ddoc(new_ddoc);callback(null)}};Queue.prototype.GetAttributes=function get_attrs(attrs,callback,extra){var self=this;if(!callback&&typeof attrs==="function"){callback=attrs;attrs=null}var confirmer=function(cb){return self.confirmed(cb)};if(attrs==="--force"){confirmer=function(cb){return self.confirmed("--force",cb)};attrs=callback;callback=extra}if(typeof attrs==="string")attrs=[attrs];attrs=attrs||["all"];assert.ok(Array.isArray(attrs));assert.ok(callback);self.log.debug("Get attributes: "+self.name);confirmer(function(er){if(er)return callback(er);callback(null,self)})};function create_queue(opts,cb){var queue=new Queue(opts);queue.create(function(er,name){if(er)return cb(er);return cb(null,queue)})}function list_queues(opts,cb){if(!cb&&typeof opts=="function"){cb=opts;opts={}}if(typeof opts=="string")opts={prefix:opts};opts=defaultable.merge(opts,DEFS);var prefix=opts.prefix||opts._str;if(!cb&&opts._func)cb=opts._func;prefix=new RegExp("^"+(prefix||""));var ddoc_url=opts.couch+"/"+encodeURIComponent(opts.db)+"/"+lib.enc_id(DDOC_ID);lib.req_json({url:ddoc_url,time_C:opts.time_C},function(er,res){if(er)return cb(er);var queues=Object.keys(res.body.queues).filter(function(name){return!!name.match(prefix)}).map(get_queue);return cb(null,queues);function get_queue(name){return new Queue({couch:opts.couch,db:opts.db,name:name,time_C:opts.time_C})}})}function set_attributes(queue,attrs,callback){return queue.set(attrs,callback)}function get_attributes(opts,attrs,callback,extra){var queue=opts instanceof Queue?opts:new Queue(opts);return queue.GetAttributes(attrs,callback,extra)}function send_message(opts,message,extra,callback){var queue;if(opts instanceof Queue)queue=opts;else if(opts.queue){if(opts.queue instanceof Queue)queue=opts.queue;else queue=new Queue({QueueName:opts.queue,couch:opts.couch||DEFS.couch,db:opts.db||DEFS.db})}else queue=new Queue(opts);if(!callback&&typeof extra==="function"){callback=extra;extra=null}return queue.send(message,extra,callback)}function receive_message(opts,callback,extra){if(typeof opts=="string")opts={queue:opts};var queue;if(opts instanceof Queue)queue=opts;else if(opts._str||opts.queue){if(opts.queue instanceof Queue)queue=opts.queue;else queue=new Queue({QueueName:opts._str||opts.queue,couch:opts.couch||DEFS.couch,db:opts.db||DEFS.db});delete opts.queue;delete opts._str}else Queue=new Queue(opts);if(typeof callback==="number"&&typeof extra==="function"){opts={MaxNumberOfMessages:callback};callback=extra}assert.ok(callback);return queue.receive(opts,callback)}module.exports={Queue:Queue,create:create_queue,list:list_queues,send:send_message,receive:receive_message,set:set_attributes,get:get_attributes}})},{"./couch.js":3,"./ddoc.js":4,"./lib.js":5,"./message.js":6,assert:26,defaultable:8,querystring:30,txn:20,util:32}],26:[function(require,module,exports){var util=require("util");var Buffer=require("buffer").Buffer;var pSlice=Array.prototype.slice;function objectKeys(object){if(Object.keys)return Object.keys(object);var result=[];for(var name in object){if(Object.prototype.hasOwnProperty.call(object,name)){result.push(name)}}return result}var assert=module.exports=ok;assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.message=options.message;this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}};util.inherits(assert.AssertionError,Error);function replacer(key,value){if(value===undefined){return""+value}if(typeof value==="number"&&(isNaN(value)||!isFinite(value))){return value.toString()}if(typeof value==="function"||value instanceof RegExp){return value.toString()}return value}function truncate(s,n){if(typeof s=="string"){return s.length<n?s:s.slice(0,n)}else{return s}}assert.AssertionError.prototype.toString=function(){if(this.message){return[this.name+":",this.message].join(" ")}else{return[this.name+":",truncate(JSON.stringify(this.actual,replacer),128),this.operator,truncate(JSON.stringify(this.expected,replacer),128)].join(" ")}};function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})
}assert.fail=fail;function ok(value,message){if(!!!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};function _deepEqual(actual,expected){if(actual===expected){return true}else if(Buffer.isBuffer(actual)&&Buffer.isBuffer(expected)){if(actual.length!=expected.length)return false;for(var i=0;i<actual.length;i++){if(actual[i]!==expected[i])return false}return true}else if(actual instanceof Date&&expected instanceof Date){return actual.getTime()===expected.getTime()}else if(typeof actual!="object"&&typeof expected!="object"){return actual==expected}else{return objEquiv(actual,expected)}}function isUndefinedOrNull(value){return value===null||value===undefined}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b){if(isUndefinedOrNull(a)||isUndefinedOrNull(b))return false;if(a.prototype!==b.prototype)return false;if(isArguments(a)){if(!isArguments(b)){return false}a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b)}try{var ka=objectKeys(a),kb=objectKeys(b),key,i}catch(e){return false}if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key]))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(expected instanceof RegExp){return expected.test(actual)}else if(actual instanceof expected){return true}else if(expected.call({},actual)===true){return true}return false}function _throws(shouldThrow,block,expected,message){var actual;if(typeof expected==="string"){message=expected;expected=null}try{block()}catch(e){actual=e}message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail("Missing expected exception"+message)}if(!shouldThrow&&expectedException(actual,expected)){fail("Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws.apply(this,[true].concat(pSlice.call(arguments)))};assert.doesNotThrow=function(block,error,message){_throws.apply(this,[false].concat(pSlice.call(arguments)))};assert.ifError=function(err){if(err){throw err}}},{buffer:34,util:32}],27:[function(require,module,exports){var process=require("__browserify_process");if(!process.EventEmitter)process.EventEmitter=function(){};var EventEmitter=exports.EventEmitter=process.EventEmitter;var isArray=typeof Array.isArray==="function"?Array.isArray:function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function indexOf(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++){if(x===xs[i])return i}return-1}var defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!this._events)this._events={};this._events.maxListeners=n};EventEmitter.prototype.emit=function(type){if(type==="error"){if(!this._events||!this._events.error||isArray(this._events.error)&&!this._events.error.length){if(arguments[1]instanceof Error){throw arguments[1]}else{throw new Error("Uncaught, unspecified 'error' event.")}return false}}if(!this._events)return false;var handler=this._events[type];if(!handler)return false;if(typeof handler=="function"){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:var args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}return true}else if(isArray(handler)){var args=Array.prototype.slice.call(arguments,1);var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args)}return true}else{return false}};EventEmitter.prototype.addListener=function(type,listener){if("function"!==typeof listener){throw new Error("addListener only takes instances of Function")}if(!this._events)this._events={};this.emit("newListener",type,listener);if(!this._events[type]){this._events[type]=listener}else if(isArray(this._events[type])){if(!this._events[type].warned){var m;if(this._events.maxListeners!==undefined){m=this._events.maxListeners}else{m=defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);console.trace()}}this._events[type].push(listener)}else{this._events[type]=[this._events[type],listener]}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){var self=this;self.on(type,function g(){self.removeListener(type,g);listener.apply(this,arguments)});return this};EventEmitter.prototype.removeListener=function(type,listener){if("function"!==typeof listener){throw new Error("removeListener only takes instances of Function")}if(!this._events||!this._events[type])return this;var list=this._events[type];if(isArray(list)){var i=indexOf(list,listener);if(i<0)return this;list.splice(i,1);if(list.length==0)delete this._events[type]}else if(this._events[type]===listener){delete this._events[type]}return this};EventEmitter.prototype.removeAllListeners=function(type){if(arguments.length===0){this._events={};return this}if(type&&this._events&&this._events[type])this._events[type]=null;return this};EventEmitter.prototype.listeners=function(type){if(!this._events)this._events={};if(!this._events[type])this._events[type]=[];if(!isArray(this._events[type])){this._events[type]=[this._events[type]]}return this._events[type]};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(typeof emitter._events[type]==="function")ret=1;else ret=emitter._events[type].length;return ret}},{__browserify_process:38}],28:[function(require,module,exports){},{}],29:[function(require,module,exports){var process=require("__browserify_process");function filter(xs,fn){var res=[];for(var i=0;i<xs.length;i++){if(fn(xs[i],i,xs))res.push(xs[i])}return res}function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length;i>=0;i--){var last=parts[i];if(last=="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"||!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=path.charAt(0)==="/",trailingSlash=path.slice(-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){return p&&typeof p==="string"}).join("/"))};exports.dirname=function(path){var dir=splitPathRe.exec(path)[1]||"";var isWindows=false;if(!dir){return"."}else if(dir.length===1||isWindows&&dir.length<=3&&dir.charAt(1)===":"){return dir}else{return dir.substring(0,dir.length-1)}};exports.basename=function(path,ext){var f=splitPathRe.exec(path)[2]||"";if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPathRe.exec(path)[3]||""};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/"},{__browserify_process:38}],30:[function(require,module,exports){var toString=Object.prototype.toString;var indexOf=typeof Array.prototype.indexOf==="function"?function(arr,el){return arr.indexOf(el)}:function(arr,el){for(var i=0;i<arr.length;i++){if(arr[i]===el)return i}return-1};var isArray=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"};var objectKeys=Object.keys||function(obj){var ret=[];for(var key in obj)ret.push(key);return ret};var forEach=typeof Array.prototype.forEach==="function"?function(arr,fn){return arr.forEach(fn)}:function(arr,fn){for(var i=0;i<arr.length;i++)fn(arr[i])};var reduce=function(arr,fn,initial){if(typeof arr.reduce==="function")return arr.reduce(fn,initial);var res=initial;for(var i=0;i<arr.length;i++)res=fn(res,arr[i]);return res};var isint=/^[0-9]+$/;function promote(parent,key){if(parent[key].length==0)return parent[key]={};var t={};for(var i in parent[key])t[i]=parent[key][i];parent[key]=t;return t}function parse(parts,parent,key,val){var part=parts.shift();if(!part){if(isArray(parent[key])){parent[key].push(val)}else if("object"==typeof parent[key]){parent[key]=val}else if("undefined"==typeof parent[key]){parent[key]=val}else{parent[key]=[parent[key],val]}}else{var obj=parent[key]=parent[key]||[];if("]"==part){if(isArray(obj)){if(""!=val)obj.push(val)}else if("object"==typeof obj){obj[objectKeys(obj).length]=val}else{obj=parent[key]=[parent[key],val]}}else if(~indexOf(part,"]")){part=part.substr(0,part.length-1);if(!isint.test(part)&&isArray(obj))obj=promote(parent,key);parse(parts,obj,part,val)}else{if(!isint.test(part)&&isArray(obj))obj=promote(parent,key);parse(parts,obj,part,val)}}}function merge(parent,key,val){if(~indexOf(key,"]")){var parts=key.split("["),len=parts.length,last=len-1;parse(parts,parent,"base",val)}else{if(!isint.test(key)&&isArray(parent.base)){var t={};for(var k in parent.base)t[k]=parent.base[k];parent.base=t}set(parent.base,key,val)}return parent}function parseObject(obj){var ret={base:{}};forEach(objectKeys(obj),function(name){merge(ret,name,obj[name])});return ret.base}function parseString(str){return reduce(String(str).split("&"),function(ret,pair){var eql=indexOf(pair,"="),brace=lastBraceInKey(pair),key=pair.substr(0,brace||eql),val=pair.substr(brace||eql,pair.length),val=val.substr(indexOf(val,"=")+1,val.length);if(""==key)key=pair,val="";if(""==key)return ret;return merge(ret,decode(key),decode(val))},{base:{}}).base}exports.parse=function(str){if(null==str||""==str)return{};return"object"==typeof str?parseObject(str):parseString(str)};var stringify=exports.stringify=function(obj,prefix){if(isArray(obj)){return stringifyArray(obj,prefix)}else if("[object Object]"==toString.call(obj)){return stringifyObject(obj,prefix)}else if("string"==typeof obj){return stringifyString(obj,prefix)}else{return prefix+"="+encodeURIComponent(String(obj))}};function stringifyString(str,prefix){if(!prefix)throw new TypeError("stringify expects an object");return prefix+"="+encodeURIComponent(str)}function stringifyArray(arr,prefix){var ret=[];if(!prefix)throw new TypeError("stringify expects an object");for(var i=0;i<arr.length;i++){ret.push(stringify(arr[i],prefix+"["+i+"]"))}return ret.join("&")}function stringifyObject(obj,prefix){var ret=[],keys=objectKeys(obj),key;for(var i=0,len=keys.length;i<len;++i){key=keys[i];if(null==obj[key]){ret.push(encodeURIComponent(key)+"=")}else{ret.push(stringify(obj[key],prefix?prefix+"["+encodeURIComponent(key)+"]":encodeURIComponent(key)))}}return ret.join("&")}function set(obj,key,val){var v=obj[key];if(undefined===v){obj[key]=val}else if(isArray(v)){v.push(val)}else{obj[key]=[v,val]}}function lastBraceInKey(str){var len=str.length,brace,c;for(var i=0;i<len;++i){c=str[i];if("]"==c)brace=false;if("["==c)brace=true;if("="==c&&!brace)return i}}function decode(str){try{return decodeURIComponent(str.replace(/\+/g," "))}catch(err){return str}}},{}],31:[function(require,module,exports){var events=require("events");var util=require("util");function Stream(){events.EventEmitter.call(this)}util.inherits(Stream,events.EventEmitter);module.exports=Stream;Stream.Stream=Stream;Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){dest._pipeCount=dest._pipeCount||0;dest._pipeCount++;source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest._pipeCount--;cleanup();if(dest._pipeCount>0){return}dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;dest._pipeCount--;cleanup();if(dest._pipeCount>0){return}dest.destroy()}function onerror(er){cleanup();if(this.listeners("error").length===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("end",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("end",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:27,util:32}],32:[function(require,module,exports){var events=require("events");exports.isArray=isArray;exports.isDate=function(obj){return Object.prototype.toString.call(obj)==="[object Date]"};exports.isRegExp=function(obj){return Object.prototype.toString.call(obj)==="[object RegExp]"};exports.print=function(){};exports.puts=function(){};exports.debug=function(){};exports.inspect=function(obj,showHidden,depth,colors){var seen=[];var stylize=function(str,styleType){var styles={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};var style={special:"cyan",number:"blue","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"}[styleType];if(style){return"["+styles[style][0]+"m"+str+"["+styles[style][1]+"m"}else{return str}};if(!colors){stylize=function(str,styleType){return str}}function format(value,recurseTimes){if(value&&typeof value.inspect==="function"&&value!==exports&&!(value.constructor&&value.constructor.prototype===value)){return value.inspect(recurseTimes)}switch(typeof value){case"undefined":return stylize("undefined","undefined");case"string":var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(simple,"string");case"number":return stylize(""+value,"number");case"boolean":return stylize(""+value,"boolean")}if(value===null){return stylize("null","null")}var visible_keys=Object_keys(value);var keys=showHidden?Object_getOwnPropertyNames(value):visible_keys;if(typeof value==="function"&&keys.length===0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{var name=value.name?": "+value.name:"";return stylize("[Function"+name+"]","special")}}if(isDate(value)&&keys.length===0){return stylize(value.toUTCString(),"date")}var base,type,braces;if(isArray(value)){type="Array";braces=["[","]"]}else{type="Object";braces=["{","}"]}if(typeof value==="function"){var n=value.name?": "+value.name:"";base=isRegExp(value)?" "+value:" [Function"+n+"]"}else{base=""}if(isDate(value)){base=" "+value.toUTCString()}if(keys.length===0){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{return stylize("[Object]","special")}}seen.push(value);var output=keys.map(function(key){var name,str;if(value.__lookupGetter__){if(value.__lookupGetter__(key)){if(value.__lookupSetter__(key)){str=stylize("[Getter/Setter]","special")}else{str=stylize("[Getter]","special")}}else{if(value.__lookupSetter__(key)){str=stylize("[Setter]","special")}}}if(visible_keys.indexOf(key)<0){name="["+key+"]"}if(!str){if(seen.indexOf(value[key])<0){if(recurseTimes===null){str=format(value[key])}else{str=format(value[key],recurseTimes-1)}if(str.indexOf("\n")>-1){if(isArray(value)){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=stylize("[Circular]","special")}}if(typeof name==="undefined"){if(type==="Array"&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=stylize(name,"string")}}return name+": "+str});seen.pop();var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.length+1},0);if(length>50){output=braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}else{output=braces[0]+base+" "+output.join(", ")+" "+braces[1]}return output}return format(obj,typeof depth==="undefined"?2:depth)};function isArray(ar){return Array.isArray(ar)||typeof ar==="object"&&Object.prototype.toString.call(ar)==="[object Array]"}function isRegExp(re){typeof re==="object"&&Object.prototype.toString.call(re)==="[object RegExp]"}function isDate(d){return typeof d==="object"&&Object.prototype.toString.call(d)==="[object Date]"}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(msg){};exports.pump=null;var Object_keys=Object.keys||function(obj){var res=[];for(var key in obj)res.push(key);return res};var Object_getOwnPropertyNames=Object.getOwnPropertyNames||function(obj){var res=[];for(var key in obj){if(Object.hasOwnProperty.call(obj,key))res.push(key)}return res};var Object_create=Object.create||function(prototype,properties){var object;if(prototype===null){object={__proto__:null}}else{if(typeof prototype!=="object"){throw new TypeError("typeof prototype["+typeof prototype+"] != 'object'")}var Type=function(){};Type.prototype=prototype;object=new Type;object.__proto__=prototype}if(typeof properties!=="undefined"&&Object.defineProperties){Object.defineProperties(object,properties)}return object};exports.inherits=function(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object_create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})};var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(typeof f!=="string"){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(exports.inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":return JSON.stringify(args[i++]);default:return x}});for(var x=args[i];i<len;x=args[++i]){if(x===null||typeof x!=="object"){str+=" "+x}else{str+=" "+exports.inspect(x)}}return str}},{events:27}],33:[function(require,module,exports){exports.readIEEE754=function(buffer,offset,isBE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isBE?0:nBytes-1,d=isBE?1:-1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.writeIEEE754=function(buffer,value,offset,isBE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isBE?nBytes-1:0,d=isBE?-1:1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],34:[function(require,module,exports){var assert=require("assert");exports.Buffer=Buffer;exports.SlowBuffer=Buffer;Buffer.poolSize=8192;exports.INSPECT_MAX_BYTES=50;function Buffer(subject,encoding,offset){if(!(this instanceof Buffer)){return new Buffer(subject,encoding,offset)}this.parent=this;this.offset=0;var type;if(typeof offset==="number"){this.length=coerce(encoding);this.offset=offset}else{switch(type=typeof subject){case"number":this.length=coerce(subject);break;case"string":this.length=Buffer.byteLength(subject,encoding);break;case"object":this.length=coerce(subject.length);break;default:throw new Error("First argument needs to be a number, "+"array or string.")}if(isArrayIsh(subject)){for(var i=0;i<this.length;i++){if(subject instanceof Buffer){this[i]=subject.readUInt8(i)}else{this[i]=subject[i]}}}else if(type=="string"){this.length=this.write(subject,0,encoding)}else if(type==="number"){for(var i=0;i<this.length;i++){this[i]=0}}}}Buffer.prototype.get=function get(i){if(i<0||i>=this.length)throw new Error("oob");return this[i]};Buffer.prototype.set=function set(i,v){if(i<0||i>=this.length)throw new Error("oob");return this[i]=v};Buffer.byteLength=function(str,encoding){switch(encoding||"utf8"){case"hex":return str.length/2;case"utf8":case"utf-8":return utf8ToBytes(str).length;case"ascii":case"binary":return str.length;case"base64":return base64ToBytes(str).length;default:throw new Error("Unknown encoding")}};Buffer.prototype.utf8Write=function(string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(utf8ToBytes(string),this,offset,length)};Buffer.prototype.asciiWrite=function(string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(asciiToBytes(string),this,offset,length)};Buffer.prototype.binaryWrite=Buffer.prototype.asciiWrite;Buffer.prototype.base64Write=function(string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(base64ToBytes(string),this,offset,length)};Buffer.prototype.base64Slice=function(start,end){var bytes=Array.prototype.slice.apply(this,arguments);return require("base64-js").fromByteArray(bytes)};Buffer.prototype.utf8Slice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var res="";var tmp="";var i=0;while(i<bytes.length){if(bytes[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(bytes[i]);tmp=""}else tmp+="%"+bytes[i].toString(16);i++}return res+decodeUtf8Char(tmp)};Buffer.prototype.asciiSlice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var ret="";for(var i=0;i<bytes.length;i++)ret+=String.fromCharCode(bytes[i]);return ret};Buffer.prototype.binarySlice=Buffer.prototype.asciiSlice;Buffer.prototype.inspect=function(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};Buffer.prototype.hexSlice=function(start,end){var len=this.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(this[i])}return out};Buffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();start=+start||0;if(typeof end=="undefined")end=this.length;if(+end==start){return""}switch(encoding){case"hex":return this.hexSlice(start,end);case"utf8":case"utf-8":return this.utf8Slice(start,end);case"ascii":return this.asciiSlice(start,end);case"binary":return this.binarySlice(start,end);case"base64":return this.base64Slice(start,end);case"ucs2":case"ucs-2":return this.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};Buffer.prototype.hexWrite=function(string,offset,length){offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2){throw new Error("Invalid hex string")}if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");this[offset+i]=byte}Buffer._charsWritten=i*2;return i};Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();switch(encoding){case"hex":return this.hexWrite(string,offset,length);case"utf8":case"utf-8":return this.utf8Write(string,offset,length);case"ascii":return this.asciiWrite(string,offset,length);case"binary":return this.binaryWrite(string,offset,length);case"base64":return this.base64Write(string,offset,length);case"ucs2":case"ucs-2":return this.ucs2Write(string,offset,length);default:throw new Error("Unknown encoding")}};Buffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length){throw new Error("oob")}if(start>end){throw new Error("oob")}return new Buffer(this,end-start,+start)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;start||(start=0);if(end===undefined||isNaN(end)){end=this.length}target_start||(target_start=0);if(end<start)throw new Error("sourceEnd < sourceStart");if(end===start)return 0;if(target.length==0||source.length==0)return 0;if(target_start<0||target_start>=target.length){throw new Error("targetStart out of bounds")}if(start<0||start>=source.length){throw new Error("sourceStart out of bounds")}if(end<0||end>source.length){throw new Error("sourceEnd out of bounds")}if(end>this.length){end=this.length}if(target.length-target_start<end-start){end=target.length-target_start+start}var temp=[];for(var i=start;i<end;i++){assert.ok(typeof this[i]!=="undefined","copying undefined buffer bytes!");temp.push(this[i])}for(var i=target_start;i<target_start+temp.length;i++){target[i]=temp[i-target_start]}};Buffer.prototype.fill=function fill(value,start,end){value||(value=0);start||(start=0);end||(end=this.length);if(typeof value==="string"){value=value.charCodeAt(0)}if(!(typeof value==="number")||isNaN(value)){throw new Error("value is not a number")}if(end<start)throw new Error("end < start");if(end===start)return 0;if(this.length==0)return 0;if(start<0||start>=this.length){throw new Error("start out of bounds")}if(end<0||end>this.length){throw new Error("end out of bounds")}for(var i=start;i<end;i++){this[i]=value}};Buffer.isBuffer=function isBuffer(b){return b instanceof Buffer||b instanceof Buffer};Buffer.concat=function(list,totalLength){if(!isArray(list)){throw new Error("Usage: Buffer.concat(list, [totalLength])\n       list should be an Array.")}if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}if(typeof totalLength!=="number"){totalLength=0;for(var i=0;i<list.length;i++){var buf=list[i];totalLength+=buf.length}}var buffer=new Buffer(totalLength);var pos=0;for(var i=0;i<list.length;i++){var buf=list[i];buf.copy(buffer,pos);pos+=buf.length}return buffer};function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function isArray(subject){return(Array.isArray||function(subject){return{}.toString.apply(subject)=="[object Array]"})(subject)}function isArrayIsh(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)if(str.charCodeAt(i)<=127)byteArray.push(str.charCodeAt(i));else{var h=encodeURIComponent(str.charAt(i)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)byteArray.push(str.charCodeAt(i)&255);return byteArray}function base64ToBytes(str){return require("base64-js").toByteArray(str)}function blitBuffer(src,dst,offset,length){var pos,i=0;while(i<length){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i];i++}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}Buffer.prototype.readUInt8=function(offset,noAssert){var buffer=this;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return;return buffer[offset]};function readUInt16(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return 0;if(isBigEndian){val=buffer[offset]<<8;if(offset+1<buffer.length){val|=buffer[offset+1]}}else{val=buffer[offset];if(offset+1<buffer.length){val|=buffer[offset+1]<<8}}return val}Buffer.prototype.readUInt16LE=function(offset,noAssert){return readUInt16(this,offset,false,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return readUInt16(this,offset,true,noAssert)};function readUInt32(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return 0;if(isBigEndian){if(offset+1<buffer.length)val=buffer[offset+1]<<16;if(offset+2<buffer.length)val|=buffer[offset+2]<<8;
if(offset+3<buffer.length)val|=buffer[offset+3];val=val+(buffer[offset]<<24>>>0)}else{if(offset+2<buffer.length)val=buffer[offset+2]<<16;if(offset+1<buffer.length)val|=buffer[offset+1]<<8;val|=buffer[offset];if(offset+3<buffer.length)val=val+(buffer[offset+3]<<24>>>0)}return val}Buffer.prototype.readUInt32LE=function(offset,noAssert){return readUInt32(this,offset,false,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return readUInt32(this,offset,true,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){var buffer=this;var neg;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return;neg=buffer[offset]&128;if(!neg){return buffer[offset]}return(255-buffer[offset]+1)*-1};function readInt16(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}val=readUInt16(buffer,offset,isBigEndian,noAssert);neg=val&32768;if(!neg){return val}return(65535-val+1)*-1}Buffer.prototype.readInt16LE=function(offset,noAssert){return readInt16(this,offset,false,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return readInt16(this,offset,true,noAssert)};function readInt32(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}val=readUInt32(buffer,offset,isBigEndian,noAssert);neg=val&2147483648;if(!neg){return val}return(4294967295-val+1)*-1}Buffer.prototype.readInt32LE=function(offset,noAssert){return readInt32(this,offset,false,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return readInt32(this,offset,true,noAssert)};function readFloat(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,23,4)}Buffer.prototype.readFloatLE=function(offset,noAssert){return readFloat(this,offset,false,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return readFloat(this,offset,true,noAssert)};function readDouble(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+7<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,52,8)}Buffer.prototype.readDoubleLE=function(offset,noAssert){return readDouble(this,offset,false,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return readDouble(this,offset,true,noAssert)};function verifuint(value,max){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value>=0,"specified a negative value for writing an unsigned value");assert.ok(value<=max,"value is larger than maximum value for type");assert.ok(Math.floor(value)===value,"value has a fractional component")}Buffer.prototype.writeUInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"trying to write beyond buffer length");verifuint(value,255)}if(offset<buffer.length){buffer[offset]=value}};function writeUInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"trying to write beyond buffer length");verifuint(value,65535)}for(var i=0;i<Math.min(buffer.length-offset,2);i++){buffer[offset+i]=(value&255<<8*(isBigEndian?1-i:i))>>>(isBigEndian?1-i:i)*8}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){writeUInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){writeUInt16(this,value,offset,true,noAssert)};function writeUInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"trying to write beyond buffer length");verifuint(value,4294967295)}for(var i=0;i<Math.min(buffer.length-offset,4);i++){buffer[offset+i]=value>>>(isBigEndian?3-i:i)*8&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){writeUInt32(this,value,offset,true,noAssert)};function verifsint(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value");assert.ok(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value")}Buffer.prototype.writeInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(value>=0){buffer.writeUInt8(value,offset,noAssert)}else{buffer.writeUInt8(255+value+1,offset,noAssert)}};function writeInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}if(value>=0){writeUInt16(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt16(buffer,65535+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){writeInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){writeInt16(this,value,offset,true,noAssert)};function writeInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}if(value>=0){writeUInt32(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt32(buffer,4294967295+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){writeInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){writeInt32(this,value,offset,true,noAssert)};function writeFloat(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,23,4)}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){writeFloat(this,value,offset,false,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){writeFloat(this,value,offset,true,noAssert)};function writeDouble(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+7<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,52,8)}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){writeDouble(this,value,offset,true,noAssert)}},{"./buffer_ieee754":33,assert:26,"base64-js":35}],35:[function(require,module,exports){(function(exports){"use strict";var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw"Invalid string. Length must be a multiple of 4"}placeHolders=b64.indexOf("=");placeHolders=placeHolders>0?b64.length-placeHolders:0;arr=[];l=placeHolders>0?b64.length-4:b64.length;for(i=0,j=0;i<l;i+=4,j+=3){tmp=lookup.indexOf(b64[i])<<18|lookup.indexOf(b64[i+1])<<12|lookup.indexOf(b64[i+2])<<6|lookup.indexOf(b64[i+3]);arr.push((tmp&16711680)>>16);arr.push((tmp&65280)>>8);arr.push(tmp&255)}if(placeHolders===2){tmp=lookup.indexOf(b64[i])<<2|lookup.indexOf(b64[i+1])>>4;arr.push(tmp&255)}else if(placeHolders===1){tmp=lookup.indexOf(b64[i])<<10|lookup.indexOf(b64[i+1])<<4|lookup.indexOf(b64[i+2])>>2;arr.push(tmp>>8&255);arr.push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=lookup[temp>>2];output+=lookup[temp<<4&63];output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=lookup[temp>>10];output+=lookup[temp>>4&63];output+=lookup[temp<<2&63];output+="=";break}return output}module.exports.toByteArray=b64ToByteArray;module.exports.fromByteArray=uint8ToBase64})()},{}],36:[function(require,module,exports){},{}],37:[function(require,module,exports){require=function(e,t,n,r){function i(r){if(!n[r]){if(!t[r]){if(e)return e(r);throw new Error("Cannot find module '"+r+"'")}var s=n[r]={exports:{}};t[r][0](function(e){var n=t[r][1][e];return i(n?n:e)},s,s.exports)}return n[r].exports}for(var s=0;s<r.length;s++)i(r[s]);return i}(typeof require!=="undefined"&&require,{1:[function(require,module,exports){var util=require("util");var Buffer=require("buffer").Buffer;var pSlice=Array.prototype.slice;function objectKeys(object){if(Object.keys)return Object.keys(object);var result=[];for(var name in object){if(Object.prototype.hasOwnProperty.call(object,name)){result.push(name)}}return result}var assert=module.exports=ok;assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.message=options.message;this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}};util.inherits(assert.AssertionError,Error);function replacer(key,value){if(value===undefined){return""+value}if(typeof value==="number"&&(isNaN(value)||!isFinite(value))){return value.toString()}if(typeof value==="function"||value instanceof RegExp){return value.toString()}return value}function truncate(s,n){if(typeof s=="string"){return s.length<n?s:s.slice(0,n)}else{return s}}assert.AssertionError.prototype.toString=function(){if(this.message){return[this.name+":",this.message].join(" ")}else{return[this.name+":",truncate(JSON.stringify(this.actual,replacer),128),this.operator,truncate(JSON.stringify(this.expected,replacer),128)].join(" ")}};assert.AssertionError.__proto__=Error.prototype;function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!!!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};function _deepEqual(actual,expected){if(actual===expected){return true}else if(Buffer.isBuffer(actual)&&Buffer.isBuffer(expected)){if(actual.length!=expected.length)return false;for(var i=0;i<actual.length;i++){if(actual[i]!==expected[i])return false}return true}else if(actual instanceof Date&&expected instanceof Date){return actual.getTime()===expected.getTime()}else if(typeof actual!="object"&&typeof expected!="object"){return actual==expected}else{return objEquiv(actual,expected)}}function isUndefinedOrNull(value){return value===null||value===undefined}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b){if(isUndefinedOrNull(a)||isUndefinedOrNull(b))return false;if(a.prototype!==b.prototype)return false;if(isArguments(a)){if(!isArguments(b)){return false}a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b)}try{var ka=objectKeys(a),kb=objectKeys(b),key,i}catch(e){return false}if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key]))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(expected instanceof RegExp){return expected.test(actual)}else if(actual instanceof expected){return true}else if(expected.call({},actual)===true){return true}return false}function _throws(shouldThrow,block,expected,message){var actual;if(typeof expected==="string"){message=expected;expected=null}try{block()}catch(e){actual=e}message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail("Missing expected exception"+message)}if(!shouldThrow&&expectedException(actual,expected)){fail("Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws.apply(this,[true].concat(pSlice.call(arguments)))};assert.doesNotThrow=function(block,error,message){_throws.apply(this,[false].concat(pSlice.call(arguments)))};assert.ifError=function(err){if(err){throw err}}},{util:2,buffer:3}],2:[function(require,module,exports){var events=require("events");exports.isArray=isArray;exports.isDate=function(obj){return Object.prototype.toString.call(obj)==="[object Date]"};exports.isRegExp=function(obj){return Object.prototype.toString.call(obj)==="[object RegExp]"};exports.print=function(){};exports.puts=function(){};exports.debug=function(){};exports.inspect=function(obj,showHidden,depth,colors){var seen=[];var stylize=function(str,styleType){var styles={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};var style={special:"cyan",number:"blue","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"}[styleType];if(style){return"["+styles[style][0]+"m"+str+"["+styles[style][1]+"m"}else{return str}};if(!colors){stylize=function(str,styleType){return str}}function format(value,recurseTimes){if(value&&typeof value.inspect==="function"&&value!==exports&&!(value.constructor&&value.constructor.prototype===value)){return value.inspect(recurseTimes)}switch(typeof value){case"undefined":return stylize("undefined","undefined");case"string":var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(simple,"string");case"number":return stylize(""+value,"number");case"boolean":return stylize(""+value,"boolean")}if(value===null){return stylize("null","null")}var visible_keys=Object_keys(value);var keys=showHidden?Object_getOwnPropertyNames(value):visible_keys;if(typeof value==="function"&&keys.length===0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{var name=value.name?": "+value.name:"";return stylize("[Function"+name+"]","special")}}if(isDate(value)&&keys.length===0){return stylize(value.toUTCString(),"date")}var base,type,braces;if(isArray(value)){type="Array";braces=["[","]"]}else{type="Object";braces=["{","}"]}if(typeof value==="function"){var n=value.name?": "+value.name:"";base=isRegExp(value)?" "+value:" [Function"+n+"]"}else{base=""}if(isDate(value)){base=" "+value.toUTCString()}if(keys.length===0){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{return stylize("[Object]","special")}}seen.push(value);var output=keys.map(function(key){var name,str;if(value.__lookupGetter__){if(value.__lookupGetter__(key)){if(value.__lookupSetter__(key)){str=stylize("[Getter/Setter]","special")}else{str=stylize("[Getter]","special")}}else{if(value.__lookupSetter__(key)){str=stylize("[Setter]","special")}}}if(visible_keys.indexOf(key)<0){name="["+key+"]"}if(!str){if(seen.indexOf(value[key])<0){if(recurseTimes===null){str=format(value[key])}else{str=format(value[key],recurseTimes-1)}if(str.indexOf("\n")>-1){if(isArray(value)){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=stylize("[Circular]","special")}}if(typeof name==="undefined"){if(type==="Array"&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=stylize(name,"string")}}return name+": "+str});seen.pop();var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.length+1},0);if(length>50){output=braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}else{output=braces[0]+base+" "+output.join(", ")+" "+braces[1]}return output}return format(obj,typeof depth==="undefined"?2:depth)};function isArray(ar){return ar instanceof Array||Array.isArray(ar)||ar&&ar!==Object.prototype&&isArray(ar.__proto__)}function isRegExp(re){return re instanceof RegExp||typeof re==="object"&&Object.prototype.toString.call(re)==="[object RegExp]"}function isDate(d){if(d instanceof Date)return true;if(typeof d!=="object")return false;var properties=Date.prototype&&Object_getOwnPropertyNames(Date.prototype);var proto=d.__proto__&&Object_getOwnPropertyNames(d.__proto__);return JSON.stringify(proto)===JSON.stringify(properties)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(msg){};exports.pump=null;var Object_keys=Object.keys||function(obj){var res=[];for(var key in obj)res.push(key);return res};var Object_getOwnPropertyNames=Object.getOwnPropertyNames||function(obj){var res=[];for(var key in obj){if(Object.hasOwnProperty.call(obj,key))res.push(key)}return res};var Object_create=Object.create||function(prototype,properties){var object;if(prototype===null){object={__proto__:null}}else{if(typeof prototype!=="object"){throw new TypeError("typeof prototype["+typeof prototype+"] != 'object'")}var Type=function(){};Type.prototype=prototype;object=new Type;object.__proto__=prototype}if(typeof properties!=="undefined"&&Object.defineProperties){Object.defineProperties(object,properties)}return object};exports.inherits=function(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object_create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})};var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(typeof f!=="string"){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(exports.inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":return JSON.stringify(args[i++]);default:return x}});for(var x=args[i];i<len;x=args[++i]){if(x===null||typeof x!=="object"){str+=" "+x}else{str+=" "+exports.inspect(x)}}return str}},{events:4}],5:[function(require,module,exports){exports.readIEEE754=function(buffer,offset,isBE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isBE?0:nBytes-1,d=isBE?1:-1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.writeIEEE754=function(buffer,value,offset,isBE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isBE?nBytes-1:0,d=isBE?-1:1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],6:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){if(ev.source===window&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],4:[function(require,module,exports){(function(process){if(!process.EventEmitter)process.EventEmitter=function(){};var EventEmitter=exports.EventEmitter=process.EventEmitter;var isArray=typeof Array.isArray==="function"?Array.isArray:function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function indexOf(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++){if(x===xs[i])return i}return-1}var defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!this._events)this._events={};this._events.maxListeners=n};EventEmitter.prototype.emit=function(type){if(type==="error"){if(!this._events||!this._events.error||isArray(this._events.error)&&!this._events.error.length){if(arguments[1]instanceof Error){throw arguments[1]}else{throw new Error("Uncaught, unspecified 'error' event.")}return false}}if(!this._events)return false;var handler=this._events[type];if(!handler)return false;if(typeof handler=="function"){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:var args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}return true}else if(isArray(handler)){var args=Array.prototype.slice.call(arguments,1);var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args)}return true}else{return false}};EventEmitter.prototype.addListener=function(type,listener){if("function"!==typeof listener){throw new Error("addListener only takes instances of Function")}if(!this._events)this._events={};this.emit("newListener",type,listener);if(!this._events[type]){this._events[type]=listener}else if(isArray(this._events[type])){if(!this._events[type].warned){var m;if(this._events.maxListeners!==undefined){m=this._events.maxListeners}else{m=defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);console.trace()}}this._events[type].push(listener)}else{this._events[type]=[this._events[type],listener]}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){var self=this;self.on(type,function g(){self.removeListener(type,g);listener.apply(this,arguments)});return this};EventEmitter.prototype.removeListener=function(type,listener){if("function"!==typeof listener){throw new Error("removeListener only takes instances of Function")}if(!this._events||!this._events[type])return this;var list=this._events[type];if(isArray(list)){var i=indexOf(list,listener);if(i<0)return this;list.splice(i,1);if(list.length==0)delete this._events[type]}else if(this._events[type]===listener){delete this._events[type]}return this};EventEmitter.prototype.removeAllListeners=function(type){if(arguments.length===0){this._events={};return this}if(type&&this._events&&this._events[type])this._events[type]=null;return this};EventEmitter.prototype.listeners=function(type){if(!this._events)this._events={};if(!this._events[type])this._events[type]=[];if(!isArray(this._events[type])){this._events[type]=[this._events[type]]}return this._events[type]}})(require("__browserify_process"))},{__browserify_process:6}],"buffer-browserify":[function(require,module,exports){module.exports=require("q9TxCC")},{}],q9TxCC:[function(require,module,exports){function SlowBuffer(size){this.length=size}var assert=require("assert");exports.INSPECT_MAX_BYTES=50;function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)if(str.charCodeAt(i)<=127)byteArray.push(str.charCodeAt(i));else{var h=encodeURIComponent(str.charAt(i)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)byteArray.push(str.charCodeAt(i)&255);return byteArray}function base64ToBytes(str){return require("base64-js").toByteArray(str)}SlowBuffer.byteLength=function(str,encoding){switch(encoding||"utf8"){case"hex":return str.length/2;case"utf8":case"utf-8":return utf8ToBytes(str).length;case"ascii":case"binary":return str.length;case"base64":return base64ToBytes(str).length;default:throw new Error("Unknown encoding")}};function blitBuffer(src,dst,offset,length){var pos,i=0;while(i<length){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i];i++}return i}SlowBuffer.prototype.utf8Write=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(utf8ToBytes(string),this,offset,length)};SlowBuffer.prototype.asciiWrite=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(asciiToBytes(string),this,offset,length)};SlowBuffer.prototype.binaryWrite=SlowBuffer.prototype.asciiWrite;SlowBuffer.prototype.base64Write=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(base64ToBytes(string),this,offset,length)};SlowBuffer.prototype.base64Slice=function(start,end){var bytes=Array.prototype.slice.apply(this,arguments);return require("base64-js").fromByteArray(bytes)};function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}SlowBuffer.prototype.utf8Slice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var res="";var tmp="";var i=0;while(i<bytes.length){if(bytes[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(bytes[i]);tmp=""}else tmp+="%"+bytes[i].toString(16);i++}return res+decodeUtf8Char(tmp)};SlowBuffer.prototype.asciiSlice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var ret="";for(var i=0;i<bytes.length;i++)ret+=String.fromCharCode(bytes[i]);return ret};SlowBuffer.prototype.binarySlice=SlowBuffer.prototype.asciiSlice;SlowBuffer.prototype.inspect=function(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<SlowBuffer "+out.join(" ")+">"};SlowBuffer.prototype.hexSlice=function(start,end){var len=this.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(this[i])}return out};SlowBuffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();start=+start||0;if(typeof end=="undefined")end=this.length;if(+end==start){return""}switch(encoding){case"hex":return this.hexSlice(start,end);case"utf8":case"utf-8":return this.utf8Slice(start,end);case"ascii":return this.asciiSlice(start,end);case"binary":return this.binarySlice(start,end);case"base64":return this.base64Slice(start,end);case"ucs2":case"ucs-2":return this.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};SlowBuffer.prototype.hexWrite=function(string,offset,length){offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2){throw new Error("Invalid hex string")}if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");this[offset+i]=byte}SlowBuffer._charsWritten=i*2;return i};SlowBuffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining
}}encoding=String(encoding||"utf8").toLowerCase();switch(encoding){case"hex":return this.hexWrite(string,offset,length);case"utf8":case"utf-8":return this.utf8Write(string,offset,length);case"ascii":return this.asciiWrite(string,offset,length);case"binary":return this.binaryWrite(string,offset,length);case"base64":return this.base64Write(string,offset,length);case"ucs2":case"ucs-2":return this.ucs2Write(string,offset,length);default:throw new Error("Unknown encoding")}};SlowBuffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length){throw new Error("oob")}if(start>end){throw new Error("oob")}return new Buffer(this,end-start,+start)};SlowBuffer.prototype.copy=function(target,targetstart,sourcestart,sourceend){var temp=[];for(var i=sourcestart;i<sourceend;i++){assert.ok(typeof this[i]!=="undefined","copying undefined buffer bytes!");temp.push(this[i])}for(var i=targetstart;i<targetstart+temp.length;i++){target[i]=temp[i-targetstart]}};SlowBuffer.prototype.fill=function(value,start,end){if(end>this.length){throw new Error("oob")}if(start>end){throw new Error("oob")}for(var i=start;i<end;i++){this[i]=value}};function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function Buffer(subject,encoding,offset){if(!(this instanceof Buffer)){return new Buffer(subject,encoding,offset)}var type;if(typeof offset==="number"){this.length=coerce(encoding);this.parent=subject;this.offset=offset}else{switch(type=typeof subject){case"number":this.length=coerce(subject);break;case"string":this.length=Buffer.byteLength(subject,encoding);break;case"object":this.length=coerce(subject.length);break;default:throw new Error("First argument needs to be a number, "+"array or string.")}if(this.length>Buffer.poolSize){this.parent=new SlowBuffer(this.length);this.offset=0}else{if(!pool||pool.length-pool.used<this.length)allocPool();this.parent=pool;this.offset=pool.used;pool.used+=this.length}if(isArrayIsh(subject)){for(var i=0;i<this.length;i++){if(subject instanceof Buffer){this.parent[i+this.offset]=subject.readUInt8(i)}else{this.parent[i+this.offset]=subject[i]}}}else if(type=="string"){this.length=this.write(subject,0,encoding)}}}function isArrayIsh(subject){return Array.isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}exports.SlowBuffer=SlowBuffer;exports.Buffer=Buffer;Buffer.poolSize=8*1024;var pool;function allocPool(){pool=new SlowBuffer(Buffer.poolSize);pool.used=0}Buffer.isBuffer=function isBuffer(b){return b instanceof Buffer||b instanceof SlowBuffer};Buffer.concat=function(list,totalLength){if(!Array.isArray(list)){throw new Error("Usage: Buffer.concat(list, [totalLength])\n       list should be an Array.")}if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}if(typeof totalLength!=="number"){totalLength=0;for(var i=0;i<list.length;i++){var buf=list[i];totalLength+=buf.length}}var buffer=new Buffer(totalLength);var pos=0;for(var i=0;i<list.length;i++){var buf=list[i];buf.copy(buffer,pos);pos+=buf.length}return buffer};Buffer.prototype.inspect=function inspect(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this.parent[i+this.offset]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};Buffer.prototype.get=function get(i){if(i<0||i>=this.length)throw new Error("oob");return this.parent[this.offset+i]};Buffer.prototype.set=function set(i,v){if(i<0||i>=this.length)throw new Error("oob");return this.parent[this.offset+i]=v};Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=this.parent.hexWrite(string,this.offset+offset,length);break;case"utf8":case"utf-8":ret=this.parent.utf8Write(string,this.offset+offset,length);break;case"ascii":ret=this.parent.asciiWrite(string,this.offset+offset,length);break;case"binary":ret=this.parent.binaryWrite(string,this.offset+offset,length);break;case"base64":ret=this.parent.base64Write(string,this.offset+offset,length);break;case"ucs2":case"ucs-2":ret=this.parent.ucs2Write(string,this.offset+offset,length);break;default:throw new Error("Unknown encoding")}Buffer._charsWritten=SlowBuffer._charsWritten;return ret};Buffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();if(typeof start=="undefined"||start<0){start=0}else if(start>this.length){start=this.length}if(typeof end=="undefined"||end>this.length){end=this.length}else if(end<0){end=0}start=start+this.offset;end=end+this.offset;switch(encoding){case"hex":return this.parent.hexSlice(start,end);case"utf8":case"utf-8":return this.parent.utf8Slice(start,end);case"ascii":return this.parent.asciiSlice(start,end);case"binary":return this.parent.binarySlice(start,end);case"base64":return this.parent.base64Slice(start,end);case"ucs2":case"ucs-2":return this.parent.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};Buffer.byteLength=SlowBuffer.byteLength;Buffer.prototype.fill=function fill(value,start,end){value||(value=0);start||(start=0);end||(end=this.length);if(typeof value==="string"){value=value.charCodeAt(0)}if(!(typeof value==="number")||isNaN(value)){throw new Error("value is not a number")}if(end<start)throw new Error("end < start");if(end===start)return 0;if(this.length==0)return 0;if(start<0||start>=this.length){throw new Error("start out of bounds")}if(end<0||end>this.length){throw new Error("end out of bounds")}return this.parent.fill(value,start+this.offset,end+this.offset)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;start||(start=0);end||(end=this.length);target_start||(target_start=0);if(end<start)throw new Error("sourceEnd < sourceStart");if(end===start)return 0;if(target.length==0||source.length==0)return 0;if(target_start<0||target_start>=target.length){throw new Error("targetStart out of bounds")}if(start<0||start>=source.length){throw new Error("sourceStart out of bounds")}if(end<0||end>source.length){throw new Error("sourceEnd out of bounds")}if(end>this.length){end=this.length}if(target.length-target_start<end-start){end=target.length-target_start+start}return this.parent.copy(target.parent,target_start+target.offset,start+this.offset,end+this.offset)};Buffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length)throw new Error("oob");if(start>end)throw new Error("oob");return new Buffer(this.parent,end-start,+start+this.offset)};Buffer.prototype.utf8Slice=function(start,end){return this.toString("utf8",start,end)};Buffer.prototype.binarySlice=function(start,end){return this.toString("binary",start,end)};Buffer.prototype.asciiSlice=function(start,end){return this.toString("ascii",start,end)};Buffer.prototype.utf8Write=function(string,offset){return this.write(string,offset,"utf8")};Buffer.prototype.binaryWrite=function(string,offset){return this.write(string,offset,"binary")};Buffer.prototype.asciiWrite=function(string,offset){return this.write(string,offset,"ascii")};Buffer.prototype.readUInt8=function(offset,noAssert){var buffer=this;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return;return buffer.parent[buffer.offset+offset]};function readUInt16(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return 0;if(isBigEndian){val=buffer.parent[buffer.offset+offset]<<8;if(offset+1<buffer.length){val|=buffer.parent[buffer.offset+offset+1]}}else{val=buffer.parent[buffer.offset+offset];if(offset+1<buffer.length){val|=buffer.parent[buffer.offset+offset+1]<<8}}return val}Buffer.prototype.readUInt16LE=function(offset,noAssert){return readUInt16(this,offset,false,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return readUInt16(this,offset,true,noAssert)};function readUInt32(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return 0;if(isBigEndian){if(offset+1<buffer.length)val=buffer.parent[buffer.offset+offset+1]<<16;if(offset+2<buffer.length)val|=buffer.parent[buffer.offset+offset+2]<<8;if(offset+3<buffer.length)val|=buffer.parent[buffer.offset+offset+3];val=val+(buffer.parent[buffer.offset+offset]<<24>>>0)}else{if(offset+2<buffer.length)val=buffer.parent[buffer.offset+offset+2]<<16;if(offset+1<buffer.length)val|=buffer.parent[buffer.offset+offset+1]<<8;val|=buffer.parent[buffer.offset+offset];if(offset+3<buffer.length)val=val+(buffer.parent[buffer.offset+offset+3]<<24>>>0)}return val}Buffer.prototype.readUInt32LE=function(offset,noAssert){return readUInt32(this,offset,false,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return readUInt32(this,offset,true,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){var buffer=this;var neg;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return;neg=buffer.parent[buffer.offset+offset]&128;if(!neg){return buffer.parent[buffer.offset+offset]}return(255-buffer.parent[buffer.offset+offset]+1)*-1};function readInt16(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}val=readUInt16(buffer,offset,isBigEndian,noAssert);neg=val&32768;if(!neg){return val}return(65535-val+1)*-1}Buffer.prototype.readInt16LE=function(offset,noAssert){return readInt16(this,offset,false,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return readInt16(this,offset,true,noAssert)};function readInt32(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}val=readUInt32(buffer,offset,isBigEndian,noAssert);neg=val&2147483648;if(!neg){return val}return(4294967295-val+1)*-1}Buffer.prototype.readInt32LE=function(offset,noAssert){return readInt32(this,offset,false,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return readInt32(this,offset,true,noAssert)};function readFloat(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,23,4)}Buffer.prototype.readFloatLE=function(offset,noAssert){return readFloat(this,offset,false,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return readFloat(this,offset,true,noAssert)};function readDouble(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+7<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,52,8)}Buffer.prototype.readDoubleLE=function(offset,noAssert){return readDouble(this,offset,false,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return readDouble(this,offset,true,noAssert)};function verifuint(value,max){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value>=0,"specified a negative value for writing an unsigned value");assert.ok(value<=max,"value is larger than maximum value for type");assert.ok(Math.floor(value)===value,"value has a fractional component")}Buffer.prototype.writeUInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"trying to write beyond buffer length");verifuint(value,255)}if(offset<buffer.length){buffer.parent[buffer.offset+offset]=value}};function writeUInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"trying to write beyond buffer length");verifuint(value,65535)}for(var i=0;i<Math.min(buffer.length-offset,2);i++){buffer.parent[buffer.offset+offset+i]=(value&255<<8*(isBigEndian?1-i:i))>>>(isBigEndian?1-i:i)*8}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){writeUInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){writeUInt16(this,value,offset,true,noAssert)};function writeUInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"trying to write beyond buffer length");verifuint(value,4294967295)}for(var i=0;i<Math.min(buffer.length-offset,4);i++){buffer.parent[buffer.offset+offset+i]=value>>>(isBigEndian?3-i:i)*8&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){writeUInt32(this,value,offset,true,noAssert)};function verifsint(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value");assert.ok(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value")}Buffer.prototype.writeInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(value>=0){buffer.writeUInt8(value,offset,noAssert)}else{buffer.writeUInt8(255+value+1,offset,noAssert)}};function writeInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}if(value>=0){writeUInt16(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt16(buffer,65535+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){writeInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){writeInt16(this,value,offset,true,noAssert)};function writeInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}if(value>=0){writeUInt32(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt32(buffer,4294967295+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){writeInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){writeInt32(this,value,offset,true,noAssert)};function writeFloat(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,23,4)}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){writeFloat(this,value,offset,false,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){writeFloat(this,value,offset,true,noAssert)};function writeDouble(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+7<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,52,8)}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){writeDouble(this,value,offset,true,noAssert)};SlowBuffer.prototype.readUInt8=Buffer.prototype.readUInt8;SlowBuffer.prototype.readUInt16LE=Buffer.prototype.readUInt16LE;SlowBuffer.prototype.readUInt16BE=Buffer.prototype.readUInt16BE;SlowBuffer.prototype.readUInt32LE=Buffer.prototype.readUInt32LE;SlowBuffer.prototype.readUInt32BE=Buffer.prototype.readUInt32BE;SlowBuffer.prototype.readInt8=Buffer.prototype.readInt8;SlowBuffer.prototype.readInt16LE=Buffer.prototype.readInt16LE;SlowBuffer.prototype.readInt16BE=Buffer.prototype.readInt16BE;SlowBuffer.prototype.readInt32LE=Buffer.prototype.readInt32LE;SlowBuffer.prototype.readInt32BE=Buffer.prototype.readInt32BE;SlowBuffer.prototype.readFloatLE=Buffer.prototype.readFloatLE;SlowBuffer.prototype.readFloatBE=Buffer.prototype.readFloatBE;SlowBuffer.prototype.readDoubleLE=Buffer.prototype.readDoubleLE;SlowBuffer.prototype.readDoubleBE=Buffer.prototype.readDoubleBE;SlowBuffer.prototype.writeUInt8=Buffer.prototype.writeUInt8;SlowBuffer.prototype.writeUInt16LE=Buffer.prototype.writeUInt16LE;SlowBuffer.prototype.writeUInt16BE=Buffer.prototype.writeUInt16BE;SlowBuffer.prototype.writeUInt32LE=Buffer.prototype.writeUInt32LE;SlowBuffer.prototype.writeUInt32BE=Buffer.prototype.writeUInt32BE;SlowBuffer.prototype.writeInt8=Buffer.prototype.writeInt8;SlowBuffer.prototype.writeInt16LE=Buffer.prototype.writeInt16LE;SlowBuffer.prototype.writeInt16BE=Buffer.prototype.writeInt16BE;SlowBuffer.prototype.writeInt32LE=Buffer.prototype.writeInt32LE;SlowBuffer.prototype.writeInt32BE=Buffer.prototype.writeInt32BE;SlowBuffer.prototype.writeFloatLE=Buffer.prototype.writeFloatLE;SlowBuffer.prototype.writeFloatBE=Buffer.prototype.writeFloatBE;SlowBuffer.prototype.writeDoubleLE=Buffer.prototype.writeDoubleLE;SlowBuffer.prototype.writeDoubleBE=Buffer.prototype.writeDoubleBE},{assert:1,"./buffer_ieee754":5,"base64-js":7}],7:[function(require,module,exports){(function(exports){"use strict";var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw"Invalid string. Length must be a multiple of 4"}placeHolders=b64.indexOf("=");placeHolders=placeHolders>0?b64.length-placeHolders:0;arr=[];l=placeHolders>0?b64.length-4:b64.length;for(i=0,j=0;i<l;i+=4,j+=3){tmp=lookup.indexOf(b64[i])<<18|lookup.indexOf(b64[i+1])<<12|lookup.indexOf(b64[i+2])<<6|lookup.indexOf(b64[i+3]);arr.push((tmp&16711680)>>16);arr.push((tmp&65280)>>8);arr.push(tmp&255)}if(placeHolders===2){tmp=lookup.indexOf(b64[i])<<2|lookup.indexOf(b64[i+1])>>4;arr.push(tmp&255)}else if(placeHolders===1){tmp=lookup.indexOf(b64[i])<<10|lookup.indexOf(b64[i+1])<<4|lookup.indexOf(b64[i+2])>>2;arr.push(tmp>>8&255);arr.push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=lookup[temp>>2];output+=lookup[temp<<4&63];output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=lookup[temp>>10];output+=lookup[temp>>4&63];output+=lookup[temp<<2&63];output+="=";break}return output}module.exports.toByteArray=b64ToByteArray;module.exports.fromByteArray=uint8ToBase64})()},{}],8:[function(require,module,exports){exports.readIEEE754=function(buffer,offset,isBE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isBE?0:nBytes-1,d=isBE?1:-1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.writeIEEE754=function(buffer,value,offset,isBE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isBE?nBytes-1:0,d=isBE?-1:1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],3:[function(require,module,exports){function SlowBuffer(size){this.length=size}var assert=require("assert");exports.INSPECT_MAX_BYTES=50;function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)if(str.charCodeAt(i)<=127)byteArray.push(str.charCodeAt(i));else{var h=encodeURIComponent(str.charAt(i)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)byteArray.push(str.charCodeAt(i)&255);return byteArray}function base64ToBytes(str){return require("base64-js").toByteArray(str)}SlowBuffer.byteLength=function(str,encoding){switch(encoding||"utf8"){case"hex":return str.length/2;case"utf8":case"utf-8":return utf8ToBytes(str).length;case"ascii":return str.length;case"base64":return base64ToBytes(str).length;default:throw new Error("Unknown encoding")}};function blitBuffer(src,dst,offset,length){var pos,i=0;while(i<length){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i];i++}return i}SlowBuffer.prototype.utf8Write=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(utf8ToBytes(string),this,offset,length)};SlowBuffer.prototype.asciiWrite=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(asciiToBytes(string),this,offset,length)};SlowBuffer.prototype.base64Write=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(base64ToBytes(string),this,offset,length)};SlowBuffer.prototype.base64Slice=function(start,end){var bytes=Array.prototype.slice.apply(this,arguments);return require("base64-js").fromByteArray(bytes)};function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}SlowBuffer.prototype.utf8Slice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var res="";var tmp="";var i=0;while(i<bytes.length){if(bytes[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(bytes[i]);tmp=""}else tmp+="%"+bytes[i].toString(16);i++}return res+decodeUtf8Char(tmp)};SlowBuffer.prototype.asciiSlice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var ret="";for(var i=0;i<bytes.length;i++)ret+=String.fromCharCode(bytes[i]);return ret};SlowBuffer.prototype.inspect=function(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<SlowBuffer "+out.join(" ")+">"};SlowBuffer.prototype.hexSlice=function(start,end){var len=this.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(this[i])}return out};SlowBuffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();start=+start||0;if(typeof end=="undefined")end=this.length;if(+end==start){return""}switch(encoding){case"hex":return this.hexSlice(start,end);case"utf8":case"utf-8":return this.utf8Slice(start,end);case"ascii":return this.asciiSlice(start,end);case"binary":return this.binarySlice(start,end);case"base64":return this.base64Slice(start,end);case"ucs2":case"ucs-2":return this.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};SlowBuffer.prototype.hexWrite=function(string,offset,length){offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2){throw new Error("Invalid hex string")}if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");this[offset+i]=byte}SlowBuffer._charsWritten=i*2;return i};SlowBuffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();switch(encoding){case"hex":return this.hexWrite(string,offset,length);case"utf8":case"utf-8":return this.utf8Write(string,offset,length);case"ascii":return this.asciiWrite(string,offset,length);case"binary":return this.binaryWrite(string,offset,length);case"base64":return this.base64Write(string,offset,length);case"ucs2":case"ucs-2":return this.ucs2Write(string,offset,length);default:throw new Error("Unknown encoding")}};SlowBuffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length){throw new Error("oob")}if(start>end){throw new Error("oob")}return new Buffer(this,end-start,+start)};SlowBuffer.prototype.copy=function(target,targetstart,sourcestart,sourceend){var temp=[];for(var i=sourcestart;i<sourceend;i++){assert.ok(typeof this[i]!=="undefined","copying undefined buffer bytes!");temp.push(this[i])}for(var i=targetstart;i<targetstart+temp.length;i++){target[i]=temp[i-targetstart]}};function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function Buffer(subject,encoding,offset){if(!(this instanceof Buffer)){return new Buffer(subject,encoding,offset)}var type;if(typeof offset==="number"){this.length=coerce(encoding);this.parent=subject;this.offset=offset}else{switch(type=typeof subject){case"number":this.length=coerce(subject);break;case"string":this.length=Buffer.byteLength(subject,encoding);break;case"object":this.length=coerce(subject.length);break;default:throw new Error("First argument needs to be a number, "+"array or string.")}if(this.length>Buffer.poolSize){this.parent=new SlowBuffer(this.length);this.offset=0}else{if(!pool||pool.length-pool.used<this.length)allocPool();this.parent=pool;this.offset=pool.used;pool.used+=this.length}if(isArrayIsh(subject)){for(var i=0;i<this.length;i++){this.parent[i+this.offset]=subject[i]}}else if(type=="string"){this.length=this.write(subject,0,encoding)}}}function isArrayIsh(subject){return Array.isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}exports.SlowBuffer=SlowBuffer;exports.Buffer=Buffer;Buffer.poolSize=8*1024;var pool;function allocPool(){pool=new SlowBuffer(Buffer.poolSize);pool.used=0}Buffer.isBuffer=function isBuffer(b){return b instanceof Buffer||b instanceof SlowBuffer};Buffer.concat=function(list,totalLength){if(!Array.isArray(list)){throw new Error("Usage: Buffer.concat(list, [totalLength])\n       list should be an Array.")}if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}if(typeof totalLength!=="number"){totalLength=0;for(var i=0;i<list.length;i++){var buf=list[i];totalLength+=buf.length}}var buffer=new Buffer(totalLength);var pos=0;for(var i=0;i<list.length;i++){var buf=list[i];buf.copy(buffer,pos);pos+=buf.length}return buffer};Buffer.prototype.inspect=function inspect(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this.parent[i+this.offset]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};Buffer.prototype.get=function get(i){if(i<0||i>=this.length)throw new Error("oob");return this.parent[this.offset+i]};Buffer.prototype.set=function set(i,v){if(i<0||i>=this.length)throw new Error("oob");return this.parent[this.offset+i]=v};Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=this.parent.hexWrite(string,this.offset+offset,length);break;case"utf8":case"utf-8":ret=this.parent.utf8Write(string,this.offset+offset,length);break;case"ascii":ret=this.parent.asciiWrite(string,this.offset+offset,length);break;case"binary":ret=this.parent.binaryWrite(string,this.offset+offset,length);break;case"base64":ret=this.parent.base64Write(string,this.offset+offset,length);break;case"ucs2":case"ucs-2":ret=this.parent.ucs2Write(string,this.offset+offset,length);break;default:throw new Error("Unknown encoding")}Buffer._charsWritten=SlowBuffer._charsWritten;return ret};Buffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();if(typeof start=="undefined"||start<0){start=0}else if(start>this.length){start=this.length}if(typeof end=="undefined"||end>this.length){end=this.length}else if(end<0){end=0}start=start+this.offset;end=end+this.offset;switch(encoding){case"hex":return this.parent.hexSlice(start,end);case"utf8":case"utf-8":return this.parent.utf8Slice(start,end);case"ascii":return this.parent.asciiSlice(start,end);case"binary":return this.parent.binarySlice(start,end);case"base64":return this.parent.base64Slice(start,end);case"ucs2":case"ucs-2":return this.parent.ucs2Slice(start,end);
default:throw new Error("Unknown encoding")}};Buffer.byteLength=SlowBuffer.byteLength;Buffer.prototype.fill=function fill(value,start,end){value||(value=0);start||(start=0);end||(end=this.length);if(typeof value==="string"){value=value.charCodeAt(0)}if(!(typeof value==="number")||isNaN(value)){throw new Error("value is not a number")}if(end<start)throw new Error("end < start");if(end===start)return 0;if(this.length==0)return 0;if(start<0||start>=this.length){throw new Error("start out of bounds")}if(end<0||end>this.length){throw new Error("end out of bounds")}return this.parent.fill(value,start+this.offset,end+this.offset)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;start||(start=0);end||(end=this.length);target_start||(target_start=0);if(end<start)throw new Error("sourceEnd < sourceStart");if(end===start)return 0;if(target.length==0||source.length==0)return 0;if(target_start<0||target_start>=target.length){throw new Error("targetStart out of bounds")}if(start<0||start>=source.length){throw new Error("sourceStart out of bounds")}if(end<0||end>source.length){throw new Error("sourceEnd out of bounds")}if(end>this.length){end=this.length}if(target.length-target_start<end-start){end=target.length-target_start+start}return this.parent.copy(target.parent,target_start+target.offset,start+this.offset,end+this.offset)};Buffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length)throw new Error("oob");if(start>end)throw new Error("oob");return new Buffer(this.parent,end-start,+start+this.offset)};Buffer.prototype.utf8Slice=function(start,end){return this.toString("utf8",start,end)};Buffer.prototype.binarySlice=function(start,end){return this.toString("binary",start,end)};Buffer.prototype.asciiSlice=function(start,end){return this.toString("ascii",start,end)};Buffer.prototype.utf8Write=function(string,offset){return this.write(string,offset,"utf8")};Buffer.prototype.binaryWrite=function(string,offset){return this.write(string,offset,"binary")};Buffer.prototype.asciiWrite=function(string,offset){return this.write(string,offset,"ascii")};Buffer.prototype.readUInt8=function(offset,noAssert){var buffer=this;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}return buffer.parent[buffer.offset+offset]};function readUInt16(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}if(isBigEndian){val=buffer.parent[buffer.offset+offset]<<8;val|=buffer.parent[buffer.offset+offset+1]}else{val=buffer.parent[buffer.offset+offset];val|=buffer.parent[buffer.offset+offset+1]<<8}return val}Buffer.prototype.readUInt16LE=function(offset,noAssert){return readUInt16(this,offset,false,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return readUInt16(this,offset,true,noAssert)};function readUInt32(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}if(isBigEndian){val=buffer.parent[buffer.offset+offset+1]<<16;val|=buffer.parent[buffer.offset+offset+2]<<8;val|=buffer.parent[buffer.offset+offset+3];val=val+(buffer.parent[buffer.offset+offset]<<24>>>0)}else{val=buffer.parent[buffer.offset+offset+2]<<16;val|=buffer.parent[buffer.offset+offset+1]<<8;val|=buffer.parent[buffer.offset+offset];val=val+(buffer.parent[buffer.offset+offset+3]<<24>>>0)}return val}Buffer.prototype.readUInt32LE=function(offset,noAssert){return readUInt32(this,offset,false,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return readUInt32(this,offset,true,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){var buffer=this;var neg;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}neg=buffer.parent[buffer.offset+offset]&128;if(!neg){return buffer.parent[buffer.offset+offset]}return(255-buffer.parent[buffer.offset+offset]+1)*-1};function readInt16(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}val=readUInt16(buffer,offset,isBigEndian,noAssert);neg=val&32768;if(!neg){return val}return(65535-val+1)*-1}Buffer.prototype.readInt16LE=function(offset,noAssert){return readInt16(this,offset,false,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return readInt16(this,offset,true,noAssert)};function readInt32(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}val=readUInt32(buffer,offset,isBigEndian,noAssert);neg=val&2147483648;if(!neg){return val}return(4294967295-val+1)*-1}Buffer.prototype.readInt32LE=function(offset,noAssert){return readInt32(this,offset,false,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return readInt32(this,offset,true,noAssert)};function readFloat(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,23,4)}Buffer.prototype.readFloatLE=function(offset,noAssert){return readFloat(this,offset,false,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return readFloat(this,offset,true,noAssert)};function readDouble(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+7<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,52,8)}Buffer.prototype.readDoubleLE=function(offset,noAssert){return readDouble(this,offset,false,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return readDouble(this,offset,true,noAssert)};function verifuint(value,max){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value>=0,"specified a negative value for writing an unsigned value");assert.ok(value<=max,"value is larger than maximum value for type");assert.ok(Math.floor(value)===value,"value has a fractional component")}Buffer.prototype.writeUInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"trying to write beyond buffer length");verifuint(value,255)}buffer.parent[buffer.offset+offset]=value};function writeUInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"trying to write beyond buffer length");verifuint(value,65535)}if(isBigEndian){buffer.parent[buffer.offset+offset]=(value&65280)>>>8;buffer.parent[buffer.offset+offset+1]=value&255}else{buffer.parent[buffer.offset+offset+1]=(value&65280)>>>8;buffer.parent[buffer.offset+offset]=value&255}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){writeUInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){writeUInt16(this,value,offset,true,noAssert)};function writeUInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"trying to write beyond buffer length");verifuint(value,4294967295)}if(isBigEndian){buffer.parent[buffer.offset+offset]=value>>>24&255;buffer.parent[buffer.offset+offset+1]=value>>>16&255;buffer.parent[buffer.offset+offset+2]=value>>>8&255;buffer.parent[buffer.offset+offset+3]=value&255}else{buffer.parent[buffer.offset+offset+3]=value>>>24&255;buffer.parent[buffer.offset+offset+2]=value>>>16&255;buffer.parent[buffer.offset+offset+1]=value>>>8&255;buffer.parent[buffer.offset+offset]=value&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){writeUInt32(this,value,offset,true,noAssert)};function verifsint(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value");assert.ok(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value")}Buffer.prototype.writeInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(value>=0){buffer.writeUInt8(value,offset,noAssert)}else{buffer.writeUInt8(255+value+1,offset,noAssert)}};function writeInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}if(value>=0){writeUInt16(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt16(buffer,65535+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){writeInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){writeInt16(this,value,offset,true,noAssert)};function writeInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}if(value>=0){writeUInt32(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt32(buffer,4294967295+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){writeInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){writeInt32(this,value,offset,true,noAssert)};function writeFloat(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,23,4)}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){writeFloat(this,value,offset,false,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){writeFloat(this,value,offset,true,noAssert)};function writeDouble(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+7<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,52,8)}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){writeDouble(this,value,offset,true,noAssert)};SlowBuffer.prototype.readUInt8=Buffer.prototype.readUInt8;SlowBuffer.prototype.readUInt16LE=Buffer.prototype.readUInt16LE;SlowBuffer.prototype.readUInt16BE=Buffer.prototype.readUInt16BE;SlowBuffer.prototype.readUInt32LE=Buffer.prototype.readUInt32LE;SlowBuffer.prototype.readUInt32BE=Buffer.prototype.readUInt32BE;SlowBuffer.prototype.readInt8=Buffer.prototype.readInt8;SlowBuffer.prototype.readInt16LE=Buffer.prototype.readInt16LE;SlowBuffer.prototype.readInt16BE=Buffer.prototype.readInt16BE;SlowBuffer.prototype.readInt32LE=Buffer.prototype.readInt32LE;SlowBuffer.prototype.readInt32BE=Buffer.prototype.readInt32BE;SlowBuffer.prototype.readFloatLE=Buffer.prototype.readFloatLE;SlowBuffer.prototype.readFloatBE=Buffer.prototype.readFloatBE;SlowBuffer.prototype.readDoubleLE=Buffer.prototype.readDoubleLE;SlowBuffer.prototype.readDoubleBE=Buffer.prototype.readDoubleBE;SlowBuffer.prototype.writeUInt8=Buffer.prototype.writeUInt8;SlowBuffer.prototype.writeUInt16LE=Buffer.prototype.writeUInt16LE;SlowBuffer.prototype.writeUInt16BE=Buffer.prototype.writeUInt16BE;SlowBuffer.prototype.writeUInt32LE=Buffer.prototype.writeUInt32LE;SlowBuffer.prototype.writeUInt32BE=Buffer.prototype.writeUInt32BE;SlowBuffer.prototype.writeInt8=Buffer.prototype.writeInt8;SlowBuffer.prototype.writeInt16LE=Buffer.prototype.writeInt16LE;SlowBuffer.prototype.writeInt16BE=Buffer.prototype.writeInt16BE;SlowBuffer.prototype.writeInt32LE=Buffer.prototype.writeInt32LE;SlowBuffer.prototype.writeInt32BE=Buffer.prototype.writeInt32BE;SlowBuffer.prototype.writeFloatLE=Buffer.prototype.writeFloatLE;SlowBuffer.prototype.writeFloatBE=Buffer.prototype.writeFloatBE;SlowBuffer.prototype.writeDoubleLE=Buffer.prototype.writeDoubleLE;SlowBuffer.prototype.writeDoubleBE=Buffer.prototype.writeDoubleBE},{assert:1,"./buffer_ieee754":8,"base64-js":9}],9:[function(require,module,exports){(function(exports){"use strict";var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw"Invalid string. Length must be a multiple of 4"}placeHolders=b64.indexOf("=");placeHolders=placeHolders>0?b64.length-placeHolders:0;arr=[];l=placeHolders>0?b64.length-4:b64.length;for(i=0,j=0;i<l;i+=4,j+=3){tmp=lookup.indexOf(b64[i])<<18|lookup.indexOf(b64[i+1])<<12|lookup.indexOf(b64[i+2])<<6|lookup.indexOf(b64[i+3]);arr.push((tmp&16711680)>>16);arr.push((tmp&65280)>>8);arr.push(tmp&255)}if(placeHolders===2){tmp=lookup.indexOf(b64[i])<<2|lookup.indexOf(b64[i+1])>>4;arr.push(tmp&255)}else if(placeHolders===1){tmp=lookup.indexOf(b64[i])<<10|lookup.indexOf(b64[i+1])<<4|lookup.indexOf(b64[i+2])>>2;arr.push(tmp>>8&255);arr.push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=lookup[temp>>2];output+=lookup[temp<<4&63];output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=lookup[temp>>10];output+=lookup[temp>>4&63];output+=lookup[temp<<2&63];output+="=";break}return output}module.exports.toByteArray=b64ToByteArray;module.exports.fromByteArray=uint8ToBase64})()},{}]},{},[]);module.exports=require("buffer-browserify")},{}],38:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){if(ev.source===window&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}]},{},[1]);